<!-- viewQStoreMain -->
<div data-role="page" id="viewQStoreMain">
    <div class="ios-fix-overlap-div"></div>
    <div data-role="header" data-position="fixed" class="page-header">
        <div class="header-style">
            <h1 class="ui-title">
                <div>
                    <!--我附近的商店-->
                    <span class="langStr" data-id="wgt_103"></span>
                </div>
            </h1>
        </div>
        <a href="#" data-role="none">
            <div class="q-btn-header page-back">
                <img src="img/component/back_nav.png" width="100%" height="100%">
            </div>
        </a>
    </div>
    <div data-role="main" class="page-main" style="line-height: initial !important;">
        <div id="map" style="width:100vw; height:90vh;"></div>
        <div id="infowindow-content">
            <img id="place-icon" src="" height="16" width="16">
            <span id="place-name"  class="title"></span><br>
            Place ID <span id="place-id"></span><br>
            <span id="place-address"></span>
        </div>
        <script>
        var map;

        function initMap() {
            var origin = { lat: 25.0811469, lng: 121.56481370000006 };

            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 11,
                center: origin
            });

            var clickHandler = new ClickEventHandler(map, origin);

            window.geocoder = new google.maps.Geocoder();
        }

        /**
         * @constructor
         */
        var ClickEventHandler = function(map, origin) {
            this.origin = origin;
            this.map = map;
            this.directionsService = new google.maps.DirectionsService;
            this.directionsDisplay = new google.maps.DirectionsRenderer;
            this.directionsDisplay.setMap(map);
            this.placesService = new google.maps.places.PlacesService(map);
            this.infowindow = new google.maps.InfoWindow;
            this.infowindowContent = document.getElementById('infowindow-content');
            this.infowindow.setContent(this.infowindowContent);

            // Listen for clicks on the map.
            this.map.addListener('click', this.handleClick.bind(this));
        };

        ClickEventHandler.prototype.handleClick = function(event) {
            console.log('You clicked on: ' + event.latLng);
            // If the event has a placeId, use it.
            if (event.placeId) {
                console.log('You clicked on place:' + event.placeId);

                // Calling e.stop() on the event prevents the default info window from
                // showing.
                // If you call stop here when there is no placeId you will prevent some
                // other map click event handlers from receiving the event.
                event.stop();
                this.calculateAndDisplayRoute(event.placeId);
                this.getPlaceInformation(event.placeId);
            }
        };

        ClickEventHandler.prototype.calculateAndDisplayRoute = function(placeId) {
            var me = this;
            this.directionsService.route({
                origin: this.origin,
                destination: { placeId: placeId },
                travelMode: 'WALKING'
            }, function(response, status) {
                if (status === 'OK') {
                    me.directionsDisplay.setDirections(response);
                } else {
                    window.alert('Directions request failed due to ' + status);
                }
            });
        };

        ClickEventHandler.prototype.getPlaceInformation = function(placeId) {
            var me = this;
            this.placesService.getDetails({ placeId: placeId }, function(place, status) {
                if (status === 'OK') {
                    me.infowindow.close();
                    me.infowindow.setPosition(place.geometry.location);
                    me.infowindowContent.children['place-icon'].src = place.icon;
                    me.infowindowContent.children['place-name'].textContent = place.name;
                    me.infowindowContent.children['place-id'].textContent = place.place_id;
                    me.infowindowContent.children['place-address'].textContent =
                        place.formatted_address;
                    me.infowindow.open(me.map);
                }
            });
        };

        </script>
        <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDfNc3zYF_DVZRjsqJrkxU2-WbjYmPxEjg&libraries=places&callback=initMap">
        </script>
    </div>
    <!--popup-->
    <!--template @popup content > Store Info -->
    <template id="tplStoreInfoPopup">
        <div class="header">
            <div class="close-popup">
                <img src="img/component/close.png" width="9.6vw" height="9.6vw">
            </div>
                <div class="basic-info font-style10">
                    <div>
                        <img src="" class="detail-type-img">
                </div>
                        <div class="qstore-list-detail read-font-normal">
                            <div>愛兒家產後護理之家</div>
                        </div>
                        <div class="qstore-distance">
                            <div></div>
                        </div>
                    </div>
                    <div class="address-info font-style10">
                        <div>
                            <img src="" class="pin-img">
                </div>
                            <div class="address-detail">台北市大安區忠孝東路4段87號6樓</div>
                        </div>
                        <div class="phone-info font-style10">
                            <div>
                                <img src="" class="phone-img">
                </div>
                                <a class="phone-type" rel="external" href="">03-331-9931</a>
                            </div>
                        </div>
                        <div class="main">
                            <div class="summary-title font-style11">
                                <!--特約優惠-->
                                <span class="langStr" data-id="wgt_111"></span>
                            </div>
                            <div class="summary-content font-style7">享九折優惠</div>
                            <div class="date-title font-style11">
                                <!--特約優惠-->
                                <span class="langStr" data-id="wgt_112"></span>
                            </div>
                            <div class="date-content font-style7">無限期</div>
                        </div>
    </template>
</div>