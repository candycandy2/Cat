<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <link rel="stylesheet" type="text/css" href="../css/lib/jquery.mobile-1.4.5.min.css">
    <link rel="stylesheet" type="text/css" href="../css/component.css">
    <link rel="stylesheet" type="text/css" href="../css/index.css">
    <script type="text/javascript" src="../js/lib/jquery-1.12.3.min.js"></script>
    <script type="text/javascript" src="../js/lib/jquery.mobile-1.4.5.min.js"></script>
    <!-- <link rel="stylesheet" type="text/css" href="../js/viewMyReserve.js"> -->
    <script>
    $(document).one("pagecreate", "#viewMyReserve", function() {

        var myReserveData = {};
        var date = new Date();

        $("#viewMyReserve").pagecontainer({
            create: function(event, ui) {

                /********************************** function *************************************/
                function myReserveHTML(index, BeginTime, EndTime, room) {
                    return '<div class="ui-btn ui-shadow ui-corner-all ui-margin-10"><div class="ui-grid-b">' 
                    + '<div class="ui-block-a ui-padding-8 col-5"><h1 class="ui-benq-color">' + BeginTime + ' - ' + EndTime + '</h1></div>' 
                    + '<div class="ui-block-b col-3"><h1 class="ui-benq-color">' + room + '</h1></div>' 
                    + '<div class="ui-block-c col-2"><a href="#Cancel" value="' + index.toString() + '" name="cancelIndex" class="btn-benq ui-btn ui-shadow ui-corner-all">取消</a></div>' 
                    + '</div></div>';
                }

                function queryMyReserve() {

                    var self = this;

                    this.successCallback = $.getJSON('../js/MyReserve', function(data) {

                        // var asc = 'asc';
                        // sortResults('ReserveDate', asc);

                        if (data['result_code'] === "1") {

                            var htmlContent = "";

                            for (var i = 0; i < data['content'].length; i++) {
                                // today
                                if (data['content'][i].ReserveDate == date.yyyymmdd()) {
                                    var content = htmlContent + myReserveHTML(
                                        data['content'][i].ReserveTraceAggID,
                                        data['content'][i].ReserveBeginTime,
                                        data['content'][i].ReserveEndTime,
                                        data['content'][i].MeetingRoomName);

                                    htmlContent = content;
                                }
                            }

                            $("#myReserve").html(htmlContent).enhanceWithin();

                        } else {
                            //ResultCode = 001901, [no data]
                        }
                    });

                    // this.failCallback = function(data) {};

                    // var __construct = function() {
                    //     QPlayAPI("POST", "QueryMyPhoneBook", self.successCallback, self.failCallback, queryData);
                    // }();

                }

                /********************************** page event *************************************/
                $("#viewMyReserve").on("pagebeforeshow", function(event, ui) {
                    // loadingMask("show");
                    queryMyReserve();
                });

                /********************************** dom event *************************************/
                function sortResults(prop, asc) {
                    myReserveData = myReserveData.sort(function(a, b) {
                        if (asc) return (a[prop] > b[prop]);
                        else return (b[prop] > a[prop]);
                    });
                }

                Date.prototype.yyyymmdd = function() {
                    var yyyy = this.getFullYear().toString();
                    var mm = (this.getMonth() + 1).toString(); // getMonth() is zero-based 
                    var dd = this.getDate().toString();
                    return yyyy + (mm[1] ? mm : "0" + mm[0]) + (dd[1] ? dd : "0" + dd[0]); // padding 
                };
            }
        });

    });
    </script>
</head>

<body>
    <div data-role="page" id="viewMyReserve">
        <div class="ios-fix-overlap-div"></div>
        <div data-role="header" data-position="fixed" class="page-header">
            <div id="container" class="header-style">
                <div id="left" class="ui-title">
                    <a href="#viewReserve">返回</a></div>
                <div id="center" class="ui-title">我的預約</div>
                <div id="right" class="ui-title">&nbsp;</div>
            </div>
        </div>
        <div id="myReserve" data-role="main" class="page-main">
            <h2 style="padding-left:5%;">今天</h2>
            <div class="ui-btn ui-shadow ui-corner-all ui-margin-10">
                <div class="ui-grid-b">
                    <div class="ui-block-a ui-padding-8 col-5">
                        <h1 class="ui-benq-color">10:30 - 12:00</h1></div>
                    <div class="ui-block-b col-3">
                        <h1 class="ui-benq-color">T131</h1></div>
                    <div class="ui-block-c col-2">
                        <a href="#Cancel" class="btn-benq ui-btn ui-shadow ui-corner-all">取消</a>
                    </div>
                </div>
            </div>
            <div class="ui-btn ui-shadow ui-corner-all ui-margin-10">
                <div class="ui-grid-b">
                    <div class="ui-block-a ui-padding-8 col-5">
                        <h1 class="ui-benq-color">10:30 - 12:00</h1></div>
                    <div class="ui-block-b col-3">
                        <h1 class="ui-benq-color">T131</h1></div>
                    <div class="ui-block-c col-2"><a href="#Cancel" class="btn-benq ui-btn ui-shadow ui-corner-all">取消</a></div>
                </div>
            </div>
            <hr class="col-95" style="margin:10px auto 10px auto;" />
            <div class="ui-btn ui-shadow ui-corner-all ui-margin-10">
                <div class="ui-grid-b">
                    <div class="ui-block-a ui-padding-8 col-5">
                        <h1 class="ui-color-lightblue"><span>9/1(四)</span><br>10:30 - 12:00</h1>
                    </div>
                    <div class="ui-block-b col-3">
                        <h1 class="ui-color-lightblue"><span>&nbsp;</span><br>T131</h1></div>
                    <div class="ui-block-c col-2"><a href="#Cancel" class="btn-benq ui-btn ui-shadow ui-corner-all" style="margin-top:15px;">取消</a></div>
                </div>
            </div>
            <div class="ui-btn ui-shadow ui-corner-all ui-margin-10">
                <div class="ui-grid-b">
                    <div class="ui-block-a ui-padding-8 col-5">
                        <h1 class="ui-color-lightblue"><span>9/1(四)</span><br>10:30 - 12:00</h1>
                    </div>
                    <div class="ui-block-b col-3">
                        <h1 class="ui-color-lightblue"><span>&nbsp;</span><br>T131</h1></div>
                    <div class="ui-block-c col-2"><a href="#Cancel" class="btn-benq ui-btn ui-shadow ui-corner-all" style="margin-top:15px;">取消</a></div>
                </div>
            </div>
            <div class="ui-btn ui-shadow ui-corner-all ui-margin-10">
                <div class="ui-grid-b">
                    <div class="ui-block-a ui-padding-8 col-5">
                        <h1 class="ui-color-lightblue"><span>9/1(四)</span><br>10:30 - 12:00</h1>
                    </div>
                    <div class="ui-block-b col-3">
                        <h1 class="ui-color-lightblue"><span>&nbsp;</span><br>T131</h1></div>
                    <div class="ui-block-c col-2"><a href="#Cancel" class="btn-benq ui-btn ui-shadow ui-corner-all" style="margin-top:15px;">取消</a></div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
