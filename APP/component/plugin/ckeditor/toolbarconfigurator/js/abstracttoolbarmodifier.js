"use strict";"function"!=typeof Object.create&&function(){var t=function(){};Object.create=function(o){if(arguments.length>1)throw Error("Second argument not supported");if(null===o)throw Error("Cannot set a null [[Prototype]]");if("object"!=typeof o)throw TypeError("Argument must be an object");return t.prototype=o,new t}}(),CKEDITOR.plugins.add("toolbarconfiguratorarea",{afterInit:function(t){t.addMode("wysiwyg",function(o){var n=CKEDITOR.dom.element.createFromHtml('<div class="cke_wysiwyg_div cke_reset" hidefocus="true"></div>');t.ui.space("contents").append(n),(n=t.editable(n)).detach=CKEDITOR.tools.override(n.detach,function(t){return function(){t.apply(this,arguments),this.remove()}}),t.setData(t.getData(1),o),t.fire("contentDom")}),t.dataProcessor.toHtml=function(t){return t},t.dataProcessor.toDataFormat=function(t){return t}}}),Object.keys||(Object.keys=function(){var t=Object.prototype.hasOwnProperty,o=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],e=n.length;return function(i){if("object"!=typeof i&&("function"!=typeof i||null===i))throw new TypeError("Object.keys called on non-object");var r,a,s=[];for(r in i)t.call(i,r)&&s.push(r);if(o)for(a=0;a<e;a++)t.call(i,n[a])&&s.push(n[a]);return s}}()),function(){function t(t,o){this.cfg=o||{},this.hidden=!1,this.editorId=t,this.fullToolbarEditor=new ToolbarConfigurator.FullToolbarEditor,this.mainContainer=null,this.originalConfig=null,this.actualConfig=null,this.waitForReady=!1,this.isEditableVisible=!1,this.toolbarContainer=null,this.toolbarButtons=[]}ToolbarConfigurator.AbstractToolbarModifier=t,t.prototype.setConfig=function(t){this._onInit(void 0,t,!0)},t.prototype.init=function(t){var o=this;if(this.mainContainer=new CKEDITOR.dom.element("div"),null!==this.fullToolbarEditor.editorInstance)throw"Only one instance of ToolbarModifier is allowed";return this.editorInstance||this._createEditor(!1),this.editorInstance.once("loaded",function(){o.fullToolbarEditor.init(function(){o._onInit(t),"function"==typeof o.onRefresh&&o.onRefresh()},o.editorInstance.config)}),this.mainContainer},t.prototype._onInit=function(t,o){this.originalConfig=this.editorInstance.config,this.actualConfig=o?JSON.parse(o):JSON.parse(JSON.stringify(this.originalConfig)),this.actualConfig.toolbarGroups||this.actualConfig.toolbar||(this.actualConfig.toolbarGroups=function(t){for(var o=t.toolbar,n=[],e=o.length,i=0;i<e;i++){var r=o[i];"string"==typeof r?n.push(r):n.push({name:r.name,groups:r.groups?r.groups.slice():[]})}return n}(this.editorInstance)),"function"==typeof t&&t(this.mainContainer)},t.prototype._createModifier=function(){return this.mainContainer.addClass("unselectable"),this.modifyContainer&&this.modifyContainer.remove(),this.modifyContainer=new CKEDITOR.dom.element("div"),this.modifyContainer.addClass("toolbarModifier"),this.mainContainer.append(this.modifyContainer),this.mainContainer},t.prototype.getEditableArea=function(){var t="#"+this.editorInstance.id+"_contents";return this.editorInstance.container.findOne(t)},t.prototype._hideEditable=function(){var t=this.getEditableArea();this.isEditableVisible=!1,this.lastEditableAreaHeight=t.getStyle("height"),t.setStyle("height","0")},t.prototype._showEditable=function(){this.isEditableVisible=!0,this.getEditableArea().setStyle("height",this.lastEditableAreaHeight||"auto")},t.prototype._toggleEditable=function(){this.isEditableVisible?this._hideEditable():this._showEditable()},t.prototype._refreshEditor=function(){function t(){o.editorInstance.destroy(),o._createEditor(!0,o.getActualConfig()),o.waitForReady=!1}var o=this,n=this.editorInstance.status;this.waitForReady||("unloaded"==n||"loaded"==n?(this.waitForReady=!0,this.editorInstance.once("instanceReady",function(){t()},this)):t())},t.prototype._createEditor=function(o,n){function e(){}var i=this;this.editorInstance=CKEDITOR.replace(this.editorId),this.editorInstance.on("configLoaded",function(){var o=i.editorInstance.config;n&&CKEDITOR.tools.extend(o,n,!0),t.extendPluginsConfig(o)}),this.editorInstance.on("uiSpace",function(t){"top"!=t.data.space&&t.stop()},null,null,-999),this.editorInstance.once("loaded",function(){var t=i.editorInstance.ui.instances;for(var n in t)t[n]&&(t[n].click=e,t[n].onClick=e);i.isEditableVisible||i._hideEditable(),i.currentActive&&i.currentActive.name&&i._highlightGroup(i.currentActive.name),i.hidden?i.hideUI():i.showUI(),o&&"function"==typeof i.onRefresh&&i.onRefresh()})},t.prototype.getActualConfig=function(){return JSON.parse(JSON.stringify(this.actualConfig))},t.prototype._createToolbar=function(){if(this.toolbarButtons.length){this.toolbarContainer=new CKEDITOR.dom.element("div"),this.toolbarContainer.addClass("toolbar");for(var t=this.toolbarButtons.length,o=0;o<t;o+=1)this._createToolbarBtn(this.toolbarButtons[o])}},t.prototype._createToolbarBtn=function(t){var o="string"==typeof t.text?t.text:t.text.inactive,n=ToolbarConfigurator.FullToolbarEditor.createButton(o,t.cssClass);return this.toolbarContainer.append(n),n.data("group",t.group),n.addClass(t.position),n.on("click",function(){t.clickCallback.call(this,n,t)},this),n},t.prototype._fixGroups=function(t){for(var o=t.toolbarGroups||[],n=o.length,e=0;e<n;e+=1){var i=o[e];"/"!=i?(i.groups=i.groups||[],-1==CKEDITOR.tools.indexOf(i.groups,i.name)&&(this.editorInstance.ui.addToolbarGroup(i.name,i.groups[i.groups.length-1],i.name),i.groups.push(i.name)),this._fixSubgroups(i)):((i=o[e]={}).type="separator",i.name="separator"+CKEDITOR.tools.getNextNumber())}},t.prototype._fixSubgroups=function(t){for(var o=t.groups,n=o.length,e=0;e<n;e+=1){var i=o[e];o[e]={name:i,totalBtns:ToolbarConfigurator.ToolbarModifier.getTotalSubGroupButtonsNumber(i,this.fullToolbarEditor)}}},t.stringifyJSONintoOneLine=function(t,o){o=o||{};var n=JSON.stringify(t,null,"");return n=n.replace(/\n/g,""),o.addSpaces&&(n=(n=n.replace(/(\{|:|,|\[|\])/g,function(t){return t+" "})).replace(/(\])/g,function(t){return" "+t})),o.noQuotesOnKey&&(n=n.replace(/"(\w*)":/g,function(t,o){return o+":"})),o.singleQuotes&&(n=n.replace(/\"/g,"'")),n},t.prototype.hideUI=function(){this.hidden=!0,this.mainContainer.hide(),this.editorInstance.container&&this.editorInstance.container.hide()},t.prototype.showUI=function(){this.hidden=!1,this.mainContainer.show(),this.editorInstance.container&&this.editorInstance.container.show()},t.extendPluginsConfig=function(t){var o=t.extraPlugins;t.extraPlugins=(o?o+",":"")+"toolbarconfiguratorarea"}}();