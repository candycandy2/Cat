!function(){function e(e){return t(e,e.activeShiftEnterMode,1)}function t(e,t,r){if(r=e.config.forceEnterMode||r,"wysiwyg"==e.mode){t||(t=e.activeEnterMode);var n=e.elementPath();n&&!n.isContextFor("p")&&(t=CKEDITOR.ENTER_BR,r=1),e.fire("saveSnapshot"),t==CKEDITOR.ENTER_BR?s(e,t,null,r):l(e,t,null,r),e.fire("saveSnapshot")}}function r(e){for(var t=e.getSelection().getRanges(!0),r=t.length-1;r>0;r--)t[r].deleteContents();return t[0]}function n(e){var t=e.startContainer.getAscendant(function(e){return e.type==CKEDITOR.NODE_ELEMENT&&"true"==e.getAttribute("contenteditable")},!0);if(e.root.equals(t))return e;var r=new CKEDITOR.dom.range(t);return r.moveToRange(e),r}CKEDITOR.plugins.add("enterkey",{init:function(r){r.addCommand("enter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(e){t(e)}}),r.addCommand("shiftEnter",{modes:{wysiwyg:1},editorFocus:!1,exec:function(t){e(t)}}),r.setKeystroke([[13,"enter"],[CKEDITOR.SHIFT+13,"shiftEnter"]])}});var i=CKEDITOR.dom.walker.whitespaces(),o=CKEDITOR.dom.walker.bookmark();CKEDITOR.plugins.enterkey={enterBlock:function(e,t,a,l){if(a=a||r(e)){var c,d=(a=n(a)).document,T=a.checkStartOfBlock(),m=a.checkEndOfBlock(),v=e.elementPath(a.startContainer),f=v.block,g=t==CKEDITOR.ENTER_DIV?"div":"p";if(T&&m){if(f&&(f.is("li")||f.getParent().is("li"))){f.is("li")||(f=f.getParent());var u,O=f.getParent(),R=O.getParent(),k=!f.hasPrevious(),C=!f.hasNext(),I=e.getSelection(),D=I.createBookmarks(),K=f.getDirection(1),N=f.getAttribute("class"),b=f.getAttribute("style"),p=R.getDirection(1)!=K,A=e.enterMode!=CKEDITOR.ENTER_BR||p||b||N;if(R.is("li"))k||C?(k&&C&&O.remove(),f[C?"insertAfter":"insertBefore"](R)):f.breakParent(R);else if(A)v.block.is("li")?(c=d.createElement(t==CKEDITOR.ENTER_P?"p":"div"),p&&c.setAttribute("dir",K),b&&c.setAttribute("style",b),N&&c.setAttribute("class",N),f.moveChildren(c)):c=v.block,k||C?c[k?"insertBefore":"insertAfter"](O):(f.breakParent(O),c.insertAfter(O)),f.remove();else{if(f.appendBogus(!0),k||C)for(;u=f[k?"getFirst":"getLast"]();)u[k?"insertBefore":"insertAfter"](O);else for(f.breakParent(O);u=f.getLast();)u.insertAfter(O);f.remove()}return void I.selectBookmarks(D)}if(f&&f.getParent().is("blockquote"))return f.breakParent(f.getParent()),f.getPrevious().getFirst(CKEDITOR.dom.walker.invisible(1))||f.getPrevious().remove(),f.getNext().getFirst(CKEDITOR.dom.walker.invisible(1))||f.getNext().remove(),a.moveToElementEditStart(f),void a.select()}else if(f&&f.is("pre")&&!m)return void s(e,t,a,l);var P=a.splitBlock(g);if(P){var B,S=P.previousBlock,h=P.nextBlock,w=P.wasStartOfBlock,x=P.wasEndOfBlock;if(h?(B=h.getParent()).is("li")&&(h.breakParent(B),h.move(h.getNext(),1)):S&&(B=S.getParent())&&B.is("li")&&(S.breakParent(B),B=S.getNext(),a.moveToElementEditStart(B),S.move(S.getPrevious())),w||x){var y;S?(S.is("li")||!E.test(S.getName())&&!S.is("pre"))&&(c=S.clone()):h&&(c=h.clone()),c?l&&!c.is("li")&&c.renameNode(g):B&&B.is("li")?c=B:(c=d.createElement(g),S&&(y=S.getDirection())&&c.setAttribute("dir",y));var _=P.elementPath;if(_)for(var F=0,L=_.elements.length;F<L;F++){var M=_.elements[F];if(M.equals(_.block)||M.equals(_.blockLimit))break;CKEDITOR.dtd.$removeEmpty[M.getName()]&&(M=M.clone(),c.moveChildren(M),c.append(M))}c.appendBogus(),c.getParent()||a.insertNode(c),c.is("li")&&c.removeAttribute("value"),!CKEDITOR.env.ie||!w||x&&S.getChildCount()||(a.moveToElementEditStart(x?S:c),a.select()),a.moveToElementEditStart(w&&!x?h:c)}else{if(h.is("li")){var $=a.clone();$.selectNodeContents(h);var q=new CKEDITOR.dom.walker($);q.evaluator=function(e){return!(o(e)||i(e)||e.type==CKEDITOR.NODE_ELEMENT&&e.getName()in CKEDITOR.dtd.$inline&&!(e.getName()in CKEDITOR.dtd.$empty))},(B=q.next())&&B.type==CKEDITOR.NODE_ELEMENT&&B.is("ul","ol")&&(CKEDITOR.env.needsBrFiller?d.createElement("br"):d.createText(" ")).insertBefore(B)}h&&a.moveToElementEditStart(h)}a.select(),a.scrollIntoView()}}},enterBr:function(e,t,n,i){if(n=n||r(e)){var o=n.document,a=n.checkEndOfBlock(),s=new CKEDITOR.dom.elementPath(e.getSelection().getStartElement()),c=s.block,d=c&&s.block.getName();if(i||"li"!=d){if(!i&&a&&E.test(d)){var T,m;(m=c.getDirection())?((T=o.createElement("div")).setAttribute("dir",m),T.insertAfter(c),n.setStart(T,0)):(o.createElement("br").insertAfter(c),CKEDITOR.env.gecko&&o.createText("").insertAfter(c),n.setStartAt(c.getNext(),CKEDITOR.env.ie?CKEDITOR.POSITION_BEFORE_START:CKEDITOR.POSITION_AFTER_START))}else{var v;v="pre"==d&&CKEDITOR.env.ie&&CKEDITOR.env.version<8?o.createText("\r"):o.createElement("br"),n.deleteContents(),n.insertNode(v),CKEDITOR.env.needsBrFiller?(o.createText("\ufeff").insertAfter(v),a&&(c||s.blockLimit).appendBogus(),v.getNext().$.nodeValue="",n.setStartAt(v.getNext(),CKEDITOR.POSITION_AFTER_START)):n.setStartAt(v,CKEDITOR.POSITION_AFTER_END)}n.collapse(!0),n.select(),n.scrollIntoView()}else l(e,t,n,i)}}};var a=CKEDITOR.plugins.enterkey,s=a.enterBr,l=a.enterBlock,E=/^h[1-6]$/}();