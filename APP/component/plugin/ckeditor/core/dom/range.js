CKEDITOR.dom.range=function(t){this.startContainer=null,this.startOffset=null,this.endContainer=null,this.endOffset=null,this.collapsed=!0;var e=t instanceof CKEDITOR.dom.document;this.document=e?t:t.getDocument(),this.root=e?t.getBody():t},function(){function t(t){t.collapsed=t.startContainer&&t.endContainer&&t.startContainer.equals(t.endContainer)&&t.startOffset==t.endOffset}function e(t,e,n,s,r){"use strict";function o(t,e,n,s){var o=n?t.getPrevious():t.getNext();return s&&d?o:(f||s?e.append(t.clone(!0,r),n):(t.remove(),I&&e.append(t,n)),o)}t.optimizeBookmark();var i,a,E,T,O,l,d=0===e,I=1==e,f=2==e,C=f||I,h=t.startContainer,u=t.endContainer,c=t.startOffset,R=t.endOffset;if(f&&u.type==CKEDITOR.NODE_TEXT&&(h.equals(u)||h.type===CKEDITOR.NODE_ELEMENT&&h.getFirst().equals(u)))n.append(t.document.createText(u.substring(c,R)));else{u.type==CKEDITOR.NODE_TEXT?f?l=!0:u=u.split(R):u.getChildCount()>0?R>=u.getChildCount()?(u=u.getChild(R-1),a=!0):u=u.getChild(R):(a=!0,T=!0),h.type==CKEDITOR.NODE_TEXT?f?O=!0:h.split(c):h.getChildCount()>0?0===c?(h=h.getChild(c),i=!0):h=h.getChild(c-1):(i=!0,E=!0);for(var D,N,g,m,K=h.getParents(),_=u.getParents(),p=function(){var t,e,n,s=Math.min(K.length,_.length);for(t=0;t<s;t++)if(e=K[t],n=_[t],!e.equals(n))return t;return t-1}(),v=K.length-1,k=_.length-1,S=n,P=-1,A=p;A<=v;A++){for(m=(N=K[A]).getNext(),A!=v||N.equals(_[A])&&v<k?C&&(D=S.append(N.clone(0,r))):i?o(N,S,!1,E):O&&S.append(t.document.createText(N.substring(c)));m;){if(m.equals(_[A])){P=A;break}m=o(m,S)}S=D}for(S=n,A=p;A<=k;A++)if(g=_[A],m=g.getPrevious(),g.equals(K[A]))C&&(S=S.getChild(0));else{if(A!=k||g.equals(K[A])&&k<v?C&&(D=S.append(g.clone(0,r))):a?o(g,S,!1,T):l&&S.append(t.document.createText(g.substring(0,R))),A>P)for(;m;)m=o(m,S,!0);S=D}f||function(){var e=p-1,n=E&&T&&!h.equals(u);if(e<v-1||e<k-1||n){if(n?t.moveToPosition(u,CKEDITOR.POSITION_BEFORE_START):k==e+1&&a?t.moveToPosition(_[e],CKEDITOR.POSITION_BEFORE_END):t.moveToPosition(_[e+1],CKEDITOR.POSITION_BEFORE_START),s){var r=K[e+1];if(r&&r.type==CKEDITOR.NODE_ELEMENT){var o=CKEDITOR.dom.element.createFromHtml('<span data-cke-bookmark="1" style="display:none">&nbsp;</span>',t.document);o.insertAfter(r),r.mergeSiblings(!1),t.moveToBookmark({startNode:o})}}}else t.collapse(!0)}()}}function n(){var t=!1,e=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.dom.walker.bookmark(!0),s=CKEDITOR.dom.walker.bogus();return function(r){return!(!n(r)&&!e(r))||(s(r)&&!t?(t=!0,!0):(r.type!=CKEDITOR.NODE_TEXT||!r.hasAscendant("pre")&&!CKEDITOR.tools.trim(r.getText()).length)&&!(r.type==CKEDITOR.NODE_ELEMENT&&!r.is(o)))}}function s(t){var e=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.dom.walker.bookmark(1);return function(s){return!(!n(s)&&!e(s))||(!t&&i(s)||s.type==CKEDITOR.NODE_ELEMENT&&s.is(CKEDITOR.dtd.$removeEmpty))}}function r(t){return function(){var e;return this[t?"getPreviousNode":"getNextNode"](function(t){return!e&&T(t)&&(e=t),E(t)&&!(i(t)&&t.equals(e))})}}var o={abbr:1,acronym:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,var:1},i=CKEDITOR.dom.walker.bogus(),a=/^[\t\r\n ]*(?:&nbsp;|\xa0)$/,E=CKEDITOR.dom.walker.editable(),T=CKEDITOR.dom.walker.ignored(!0);CKEDITOR.dom.range.prototype={clone:function(){var t=new CKEDITOR.dom.range(this.root);return t._setStartContainer(this.startContainer),t.startOffset=this.startOffset,t._setEndContainer(this.endContainer),t.endOffset=this.endOffset,t.collapsed=this.collapsed,t},collapse:function(t){t?(this._setEndContainer(this.startContainer),this.endOffset=this.startOffset):(this._setStartContainer(this.endContainer),this.startOffset=this.endOffset),this.collapsed=!0},cloneContents:function(t){var n=new CKEDITOR.dom.documentFragment(this.document);return t=void 0===t||t,this.collapsed||e(this,2,n,!1,t),n},deleteContents:function(t){this.collapsed||e(this,0,null,t)},extractContents:function(t,n){var s=new CKEDITOR.dom.documentFragment(this.document);return n=void 0===n||n,this.collapsed||e(this,1,s,t,n),s},createBookmark:function(t){var e,n,s,r,o=this.collapsed;return(e=this.document.createElement("span")).data("cke-bookmark",1),e.setStyle("display","none"),e.setHtml("&nbsp;"),t&&(s="cke_bm_"+CKEDITOR.tools.getNextNumber(),e.setAttribute("id",s+(o?"C":"S"))),o||((n=e.clone()).setHtml("&nbsp;"),t&&n.setAttribute("id",s+"E"),(r=this.clone()).collapse(),r.insertNode(n)),(r=this.clone()).collapse(!0),r.insertNode(e),n?(this.setStartAfter(e),this.setEndBefore(n)):this.moveToPosition(e,CKEDITOR.POSITION_AFTER_END),{startNode:t?s+(o?"C":"S"):e,endNode:t?s+"E":n,serializable:t,collapsed:o}},createBookmark2:function(){function t(t,e){return t.type!=CKEDITOR.NODE_ELEMENT||0===e||e==t.getChildCount()?0:t.getChild(e-1).type==CKEDITOR.NODE_TEXT&&t.getChild(e).type==CKEDITOR.NODE_TEXT}function e(t){for(var e=0;(t=t.getPrevious())&&t.type==CKEDITOR.NODE_TEXT;)e+=t.getText().replace(CKEDITOR.dom.selection.FILLING_CHAR_SEQUENCE,"").length;return e}function n(n){var s=n.container,i=n.offset;if(t(s,i)&&(i=(s=s.getChild(i-1)).getLength()),s.type==CKEDITOR.NODE_ELEMENT&&i>0&&(i=r(s,i)+1),s.type==CKEDITOR.NODE_TEXT){var a=e(s);if(s.getText())i+=a;else{var E=s.getPrevious(o);a?(i=a,s=E?E.getNext():s.getParent().getFirst()):(s=s.getParent(),i=E?E.getIndex(!0)+1:0)}}n.container=s,n.offset=i}function s(t,e){var n=e.getCustomData("cke-fillingChar");if(n){var s=t.container;return n.equals(s)?(t.offset-=CKEDITOR.dom.selection.FILLING_CHAR_SEQUENCE.length,void(t.offset<=0&&(t.offset=s.getIndex(),t.container=s.getParent()))):void 0}}function r(t,e){for(var n;e--;)if((n=t.getChild(e).getIndex(!0))>=0)return n;return-1}var o=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_TEXT,!0);return function(t){var e=this.collapsed,r={container:this.startContainer,offset:this.startOffset},o={container:this.endContainer,offset:this.endOffset};return t&&(n(r),s(r,this.root),e||(n(o),s(o,this.root))),{start:r.container.getAddress(t),end:e?null:o.container.getAddress(t),startOffset:r.offset,endOffset:o.offset,normalized:t,collapsed:e,is2:!0}}}(),moveToBookmark:function(t){if(t.is2){var e=this.document.getByAddress(t.start,t.normalized),n=t.startOffset,s=t.end&&this.document.getByAddress(t.end,t.normalized),r=t.endOffset;this.setStart(e,n),s?this.setEnd(s,r):this.collapse(!0)}else{var o=t.serializable,i=o?this.document.getById(t.startNode):t.startNode,a=o?this.document.getById(t.endNode):t.endNode;this.setStartBefore(i),i.remove(),a?(this.setEndBefore(a),a.remove()):this.collapse(!0)}},getBoundaryNodes:function(){var t,e=this.startContainer,n=this.endContainer,s=this.startOffset,r=this.endOffset;if(e.type==CKEDITOR.NODE_ELEMENT)if((t=e.getChildCount())>s)e=e.getChild(s);else if(t<1)e=e.getPreviousSourceNode();else{for(e=e.$;e.lastChild;)e=e.lastChild;e=(e=new CKEDITOR.dom.node(e)).getNextSourceNode()||e}if(n.type==CKEDITOR.NODE_ELEMENT)if((t=n.getChildCount())>r)n=n.getChild(r).getPreviousSourceNode(!0);else if(t<1)n=n.getPreviousSourceNode();else{for(n=n.$;n.lastChild;)n=n.lastChild;n=new CKEDITOR.dom.node(n)}return e.getPosition(n)&CKEDITOR.POSITION_FOLLOWING&&(e=n),{startNode:e,endNode:n}},getCommonAncestor:function(t,e){var n,s=this.startContainer,r=this.endContainer;return n=s.equals(r)?t&&s.type==CKEDITOR.NODE_ELEMENT&&this.startOffset==this.endOffset-1?s.getChild(this.startOffset):s:s.getCommonAncestor(r),e&&!n.is?n.getParent():n},optimize:function(){var t=this.startContainer,e=this.startOffset;t.type!=CKEDITOR.NODE_ELEMENT&&(e?e>=t.getLength()&&this.setStartAfter(t):this.setStartBefore(t)),t=this.endContainer,e=this.endOffset,t.type!=CKEDITOR.NODE_ELEMENT&&(e?e>=t.getLength()&&this.setEndAfter(t):this.setEndBefore(t))},optimizeBookmark:function(){var t=this.startContainer,e=this.endContainer;t.is&&t.is("span")&&t.data("cke-bookmark")&&this.setStartAt(t,CKEDITOR.POSITION_BEFORE_START),e&&e.is&&e.is("span")&&e.data("cke-bookmark")&&this.setEndAt(e,CKEDITOR.POSITION_AFTER_END)},trim:function(t,e){var n=this.startContainer,s=this.startOffset,r=this.collapsed;if((!t||r)&&n&&n.type==CKEDITOR.NODE_TEXT){if(s)if(s>=n.getLength())s=n.getIndex()+1,n=n.getParent();else{var o=n.split(s);s=n.getIndex()+1,n=n.getParent(),this.startContainer.equals(this.endContainer)?this.setEnd(o,this.endOffset-this.startOffset):n.equals(this.endContainer)&&(this.endOffset+=1)}else s=n.getIndex(),n=n.getParent();if(this.setStart(n,s),r)return void this.collapse(!0)}var i=this.endContainer,a=this.endOffset;e||r||!i||i.type!=CKEDITOR.NODE_TEXT||(a?a>=i.getLength()?(a=i.getIndex()+1,i=i.getParent()):(i.split(a),a=i.getIndex()+1,i=i.getParent()):(a=i.getIndex(),i=i.getParent()),this.setEnd(i,a))},enlarge:function(t,e){function n(t,e){var n=new CKEDITOR.dom.range(f);n.setStart(t,e),n.setEndAt(f,CKEDITOR.POSITION_BEFORE_END);var s,o=new CKEDITOR.dom.walker(n);for(o.guard=function(t){return!(t.type==CKEDITOR.NODE_ELEMENT&&t.isBlockBoundary())};s=o.next();){if(s.type!=CKEDITOR.NODE_TEXT)return!1;if(d=s!=t?s.getText():s.substring(e),r.test(d))return!1}return!0}function s(t){return t&&t.type==CKEDITOR.NODE_ELEMENT&&t.hasAttribute("contenteditable")?null:t}var r=new RegExp(/[^\s\ufeff]/);switch(t){case CKEDITOR.ENLARGE_INLINE:var o=1;case CKEDITOR.ENLARGE_ELEMENT:if(this.collapsed)return;var i,a,E,T,O,l,d,I=this.getCommonAncestor(),f=this.root,C=!1,h=this.startContainer,u=this.startOffset;for(h.type==CKEDITOR.NODE_TEXT?(u&&(C=!!(h=!CKEDITOR.tools.trim(h.substring(0,u)).length&&h)),h&&((T=h.getPrevious())||(E=h.getParent()))):(u&&(T=h.getChild(u-1)||h.getLast()),T||(E=h)),E=s(E);E||T;){if(E&&!T){if(!O&&E.equals(I)&&(O=!0),o?E.isBlockBoundary():!f.contains(E))break;C&&"inline"==E.getComputedStyle("display")||(C=!1,O?i=E:this.setStartBefore(E)),T=E.getPrevious()}for(;T;)if(l=!1,T.type!=CKEDITOR.NODE_COMMENT){if(T.type==CKEDITOR.NODE_TEXT)d=T.getText(),r.test(d)&&(T=null),l=/[\s\ufeff]$/.test(d);else{var c=CKEDITOR.env.webkit?1:0;if((T.$.offsetWidth>c||e&&T.is("br"))&&!T.data("cke-bookmark"))if(C&&CKEDITOR.dtd.$removeEmpty[T.getName()]){if(d=T.getText(),r.test(d))T=null;else for(var R,D=T.$.getElementsByTagName("*"),N=0;R=D[N++];)if(!CKEDITOR.dtd.$removeEmpty[R.nodeName.toLowerCase()]){T=null;break}T&&(l=!!d.length)}else T=null}if(l&&(C?O?i=E:E&&this.setStartBefore(E):C=!0),T){var g=T.getPrevious();if(!E&&!g){E=T,T=null;break}T=g}else E=null}else T=T.getPrevious();E&&(E=s(E.getParent()))}for(h=this.endContainer,u=this.endOffset,E=T=null,O=C=!1,h.type==CKEDITOR.NODE_TEXT?CKEDITOR.tools.trim(h.substring(u)).length?C=!0:(C=!h.getLength(),u==h.getLength()?(T=h.getNext())||(E=h.getParent()):n(h,u)&&(E=h.getParent())):(T=h.getChild(u))||(E=h);E||T;){if(E&&!T){if(!O&&E.equals(I)&&(O=!0),o?E.isBlockBoundary():!f.contains(E))break;C&&"inline"==E.getComputedStyle("display")||(C=!1,O?a=E:E&&this.setEndAfter(E)),T=E.getNext()}for(;T;){if(l=!1,T.type==CKEDITOR.NODE_TEXT)d=T.getText(),n(T,0)||(T=null),l=/^[\s\ufeff]/.test(d);else if(T.type==CKEDITOR.NODE_ELEMENT){if((T.$.offsetWidth>0||e&&T.is("br"))&&!T.data("cke-bookmark"))if(C&&CKEDITOR.dtd.$removeEmpty[T.getName()]){if(d=T.getText(),r.test(d))T=null;else for(D=T.$.getElementsByTagName("*"),N=0;R=D[N++];)if(!CKEDITOR.dtd.$removeEmpty[R.nodeName.toLowerCase()]){T=null;break}T&&(l=!!d.length)}else T=null}else l=1;if(l&&C&&(O?a=E:this.setEndAfter(E)),T){if(g=T.getNext(),!E&&!g){E=T,T=null;break}T=g}else E=null}E&&(E=s(E.getParent()))}i&&a&&(I=i.contains(a)?a:i,this.setStartBefore(I),this.setEndAfter(I));break;case CKEDITOR.ENLARGE_BLOCK_CONTENTS:case CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS:var m=new CKEDITOR.dom.range(this.root);f=this.root,m.setStartAt(f,CKEDITOR.POSITION_AFTER_START),m.setEnd(this.startContainer,this.startOffset);var K,_,p=new CKEDITOR.dom.walker(m),v=CKEDITOR.dom.walker.blockBoundary(t==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?{br:1}:null),k=null,S=function(t){if(t.type==CKEDITOR.NODE_ELEMENT&&"false"==t.getAttribute("contenteditable"))if(k){if(k.equals(t))return void(k=null)}else k=t;else if(k)return;var e=v(t);return e||(K=t),e};if(p.guard=S,E=p.lastBackward(),K=K||f,this.setStartAt(K,!K.is("br")&&(!E&&this.checkStartOfBlock()||E&&K.contains(E))?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_AFTER_END),t==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS){var P=this.clone();p=new CKEDITOR.dom.walker(P);var A=CKEDITOR.dom.walker.whitespaces(),b=CKEDITOR.dom.walker.bookmark();p.evaluator=function(t){return!A(t)&&!b(t)};var B=p.previous();if(B&&B.type==CKEDITOR.NODE_ELEMENT&&B.is("br"))return}(m=this.clone()).collapse(),m.setEndAt(f,CKEDITOR.POSITION_BEFORE_END),(p=new CKEDITOR.dom.walker(m)).guard=t==CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS?function(t){var e=S(t);return!e&&t.is&&t.is("br")&&(_=t),e}:S,K=k=_=null,E=p.lastForward(),K=K||f,this.setEndAt(K,!E&&this.checkEndOfBlock()||E&&K.contains(E)?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_BEFORE_START),_&&this.setEndAfter(_)}},shrink:function(t,e,n){var s="boolean"==typeof n?n:!n||"boolean"!=typeof n.shrinkOnBlockBoundary||n.shrinkOnBlockBoundary,r=n&&n.skipBogus;if(!this.collapsed){t=t||CKEDITOR.SHRINK_TEXT;var o=this.clone(),i=this.startContainer,a=this.endContainer,E=this.startOffset,T=this.endOffset,O=1,l=1;i&&i.type==CKEDITOR.NODE_TEXT&&(E?E>=i.getLength()?o.setStartAfter(i):(o.setStartBefore(i),O=0):o.setStartBefore(i)),a&&a.type==CKEDITOR.NODE_TEXT&&(T?T>=a.getLength()?o.setEndAfter(a):(o.setEndAfter(a),l=0):o.setEndBefore(a));var d=new CKEDITOR.dom.walker(o),I=CKEDITOR.dom.walker.bookmark(),f=CKEDITOR.dom.walker.bogus();d.evaluator=function(e){return e.type==(t==CKEDITOR.SHRINK_ELEMENT?CKEDITOR.NODE_ELEMENT:CKEDITOR.NODE_TEXT)};var C;if(d.guard=function(e,n){return!(!r||!f(e))||(!!I(e)||(t!=CKEDITOR.SHRINK_ELEMENT||e.type!=CKEDITOR.NODE_TEXT)&&((!n||!e.equals(C))&&((!1!==s||e.type!=CKEDITOR.NODE_ELEMENT||!e.isBlockBoundary())&&((e.type!=CKEDITOR.NODE_ELEMENT||!e.hasAttribute("contenteditable"))&&(n||e.type!=CKEDITOR.NODE_ELEMENT||(C=e),!0)))))},O){var h=d[t==CKEDITOR.SHRINK_ELEMENT?"lastForward":"next"]();h&&this.setStartAt(h,e?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_START)}if(l){d.reset();var u=d[t==CKEDITOR.SHRINK_ELEMENT?"lastBackward":"previous"]();u&&this.setEndAt(u,e?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_END)}return!(!O&&!l)}},insertNode:function(t){this.optimizeBookmark(),this.trim(!1,!0);var e=this.startContainer,n=this.startOffset,s=e.getChild(n);s?t.insertBefore(s):e.append(t),t.getParent()&&t.getParent().equals(this.endContainer)&&this.endOffset++,this.setStartBefore(t)},moveToPosition:function(t,e){this.setStartAt(t,e),this.collapse(!0)},moveToRange:function(t){this.setStart(t.startContainer,t.startOffset),this.setEnd(t.endContainer,t.endOffset)},selectNodeContents:function(t){this.setStart(t,0),this.setEnd(t,t.type==CKEDITOR.NODE_TEXT?t.getLength():t.getChildCount())},setStart:function(e,n){e.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[e.getName()]&&(n=e.getIndex(),e=e.getParent()),this._setStartContainer(e),this.startOffset=n,this.endContainer||(this._setEndContainer(e),this.endOffset=n),t(this)},setEnd:function(e,n){e.type==CKEDITOR.NODE_ELEMENT&&CKEDITOR.dtd.$empty[e.getName()]&&(n=e.getIndex()+1,e=e.getParent()),this._setEndContainer(e),this.endOffset=n,this.startContainer||(this._setStartContainer(e),this.startOffset=n),t(this)},setStartAfter:function(t){this.setStart(t.getParent(),t.getIndex()+1)},setStartBefore:function(t){this.setStart(t.getParent(),t.getIndex())},setEndAfter:function(t){this.setEnd(t.getParent(),t.getIndex()+1)},setEndBefore:function(t){this.setEnd(t.getParent(),t.getIndex())},setStartAt:function(e,n){switch(n){case CKEDITOR.POSITION_AFTER_START:this.setStart(e,0);break;case CKEDITOR.POSITION_BEFORE_END:e.type==CKEDITOR.NODE_TEXT?this.setStart(e,e.getLength()):this.setStart(e,e.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setStartBefore(e);break;case CKEDITOR.POSITION_AFTER_END:this.setStartAfter(e)}t(this)},setEndAt:function(e,n){switch(n){case CKEDITOR.POSITION_AFTER_START:this.setEnd(e,0);break;case CKEDITOR.POSITION_BEFORE_END:e.type==CKEDITOR.NODE_TEXT?this.setEnd(e,e.getLength()):this.setEnd(e,e.getChildCount());break;case CKEDITOR.POSITION_BEFORE_START:this.setEndBefore(e);break;case CKEDITOR.POSITION_AFTER_END:this.setEndAfter(e)}t(this)},fixBlock:function(t,e){var n=this.createBookmark(),s=this.document.createElement(e);this.collapse(t),this.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS),this.extractContents().appendTo(s),s.trim(),this.insertNode(s);var r=s.getBogus();return r&&r.remove(),s.appendBogus(),this.moveToBookmark(n),s},splitBlock:function(t,e){var n=new CKEDITOR.dom.elementPath(this.startContainer,this.root),s=new CKEDITOR.dom.elementPath(this.endContainer,this.root),r=n.blockLimit,o=s.blockLimit,i=n.block,a=s.block,E=null;if(!r.equals(o))return null;"br"!=t&&(i||(i=this.fixBlock(!0,t),a=new CKEDITOR.dom.elementPath(this.endContainer,this.root).block),a||(a=this.fixBlock(!1,t)));var T=i&&this.checkStartOfBlock(),O=a&&this.checkEndOfBlock();return this.deleteContents(),i&&i.equals(a)&&(O?(E=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(a,CKEDITOR.POSITION_AFTER_END),a=null):T?(E=new CKEDITOR.dom.elementPath(this.startContainer,this.root),this.moveToPosition(i,CKEDITOR.POSITION_BEFORE_START),i=null):(a=this.splitElement(i,e||!1),i.is("ul","ol")||i.appendBogus())),{previousBlock:i,nextBlock:a,wasStartOfBlock:T,wasEndOfBlock:O,elementPath:E}},splitElement:function(t,e){if(!this.collapsed)return null;this.setEndAt(t,CKEDITOR.POSITION_BEFORE_END);var n=this.extractContents(!1,e||!1),s=t.clone(!1,e||!1);return n.appendTo(s),s.insertAfter(t),this.moveToPosition(t,CKEDITOR.POSITION_AFTER_END),s},removeEmptyBlocksAtEnd:function(){function t(t){return function(s){return!(e(s)||n(s)||s.type==CKEDITOR.NODE_ELEMENT&&s.isEmptyInlineRemoveable())&&(!t.is("table")||!s.is("caption"))}}var e=CKEDITOR.dom.walker.whitespaces(),n=CKEDITOR.dom.walker.bookmark(!1);return function(e){for(var n,s=this.createBookmark(),r=this[e?"endPath":"startPath"](),o=r.block||r.blockLimit;o&&!o.equals(r.root)&&!o.getFirst(t(o));)n=o.getParent(),this[e?"setEndAt":"setStartAt"](o,CKEDITOR.POSITION_AFTER_END),o.remove(1),o=n;this.moveToBookmark(s)}}(),startPath:function(){return new CKEDITOR.dom.elementPath(this.startContainer,this.root)},endPath:function(){return new CKEDITOR.dom.elementPath(this.endContainer,this.root)},checkBoundaryOfElement:function(t,e){var n=e==CKEDITOR.START,r=this.clone();r.collapse(n),r[n?"setStartAt":"setEndAt"](t,n?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END);var o=new CKEDITOR.dom.walker(r);return o.evaluator=s(n),o[n?"checkBackward":"checkForward"]()},checkStartOfBlock:function(){var t=this.startContainer,e=this.startOffset;if(CKEDITOR.env.ie&&e&&t.type==CKEDITOR.NODE_TEXT){var s=CKEDITOR.tools.ltrim(t.substring(0,e));a.test(s)&&this.trim(0,1)}this.trim();var r=new CKEDITOR.dom.elementPath(this.startContainer,this.root),o=this.clone();o.collapse(!0),o.setStartAt(r.block||r.blockLimit,CKEDITOR.POSITION_AFTER_START);var i=new CKEDITOR.dom.walker(o);return i.evaluator=n(),i.checkBackward()},checkEndOfBlock:function(){var t=this.endContainer,e=this.endOffset;if(CKEDITOR.env.ie&&t.type==CKEDITOR.NODE_TEXT){var s=CKEDITOR.tools.rtrim(t.substring(e));a.test(s)&&this.trim(1,0)}this.trim();var r=new CKEDITOR.dom.elementPath(this.endContainer,this.root),o=this.clone();o.collapse(!1),o.setEndAt(r.block||r.blockLimit,CKEDITOR.POSITION_BEFORE_END);var i=new CKEDITOR.dom.walker(o);return i.evaluator=n(),i.checkForward()},getPreviousNode:function(t,e,n){var s=this.clone();s.collapse(1),s.setStartAt(n||this.root,CKEDITOR.POSITION_AFTER_START);var r=new CKEDITOR.dom.walker(s);return r.evaluator=t,r.guard=e,r.previous()},getNextNode:function(t,e,n){var s=this.clone();s.collapse(),s.setEndAt(n||this.root,CKEDITOR.POSITION_BEFORE_END);var r=new CKEDITOR.dom.walker(s);return r.evaluator=t,r.guard=e,r.next()},checkReadOnly:function(){function t(t,e){for(;t;){if(t.type==CKEDITOR.NODE_ELEMENT){if("false"==t.getAttribute("contentEditable")&&!t.data("cke-editable"))return 0;if(t.is("html")||"true"==t.getAttribute("contentEditable")&&(t.contains(e)||t.equals(e)))break}t=t.getParent()}return 1}return function(){var e=this.startContainer,n=this.endContainer;return!(t(e,n)&&t(n,e))}}(),moveToElementEditablePosition:function(t,e){if(t.type==CKEDITOR.NODE_ELEMENT&&!t.isEditable(!1))return this.moveToPosition(t,e?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),!0;for(var n=0;t;){if(t.type==CKEDITOR.NODE_TEXT){e&&this.endContainer&&this.checkEndOfBlock()&&a.test(t.getText())?this.moveToPosition(t,CKEDITOR.POSITION_BEFORE_START):this.moveToPosition(t,e?CKEDITOR.POSITION_AFTER_END:CKEDITOR.POSITION_BEFORE_START),n=1;break}if(t.type==CKEDITOR.NODE_ELEMENT)if(t.isEditable())this.moveToPosition(t,e?CKEDITOR.POSITION_BEFORE_END:CKEDITOR.POSITION_AFTER_START),n=1;else if(e&&t.is("br")&&this.endContainer&&this.checkEndOfBlock())this.moveToPosition(t,CKEDITOR.POSITION_BEFORE_START);else if("false"==t.getAttribute("contenteditable")&&t.is(CKEDITOR.dtd.$block))return this.setStartBefore(t),this.setEndAfter(t),!0;t=function(t,n){var s;return t.type==CKEDITOR.NODE_ELEMENT&&t.isEditable(!1)&&(s=t[e?"getLast":"getFirst"](T)),n||s||(s=t[e?"getPrevious":"getNext"](T)),s}(t,n)}return!!n},moveToClosestEditablePosition:function(t,e){var n,s,r,o=0,i=[CKEDITOR.POSITION_AFTER_END,CKEDITOR.POSITION_BEFORE_START];return t?(n=new CKEDITOR.dom.range(this.root)).moveToPosition(t,i[e?0:1]):n=this.clone(),t&&!t.is(CKEDITOR.dtd.$block)?o=1:(s=n[e?"getNextEditableNode":"getPreviousEditableNode"]())&&(o=1,(r=s.type==CKEDITOR.NODE_ELEMENT)&&s.is(CKEDITOR.dtd.$block)&&"false"==s.getAttribute("contenteditable")?(n.setStartAt(s,CKEDITOR.POSITION_BEFORE_START),n.setEndAt(s,CKEDITOR.POSITION_AFTER_END)):!CKEDITOR.env.needsBrFiller&&r&&s.is(CKEDITOR.dom.walker.validEmptyBlockContainers)?(n.setEnd(s,0),n.collapse()):n.moveToPosition(s,i[e?1:0])),o&&this.moveToRange(n),!!o},moveToElementEditStart:function(t){return this.moveToElementEditablePosition(t)},moveToElementEditEnd:function(t){return this.moveToElementEditablePosition(t,!0)},getEnclosedNode:function(){var t=this.clone();if(t.optimize(),t.startContainer.type!=CKEDITOR.NODE_ELEMENT||t.endContainer.type!=CKEDITOR.NODE_ELEMENT)return null;var e=new CKEDITOR.dom.walker(t),n=CKEDITOR.dom.walker.bookmark(!1,!0),s=CKEDITOR.dom.walker.whitespaces(!0);e.evaluator=function(t){return s(t)&&n(t)};var r=e.next();return e.reset(),r&&r.equals(e.previous())?r:null},getTouchedStartNode:function(){var t=this.startContainer;return this.collapsed||t.type!=CKEDITOR.NODE_ELEMENT?t:t.getChild(this.startOffset)||t},getTouchedEndNode:function(){var t=this.endContainer;return this.collapsed||t.type!=CKEDITOR.NODE_ELEMENT?t:t.getChild(this.endOffset-1)||t},getNextEditableNode:r(),getPreviousEditableNode:r(1),_getTableElement:function(t){t=t||{td:1,th:1,tr:1,tbody:1,thead:1,tfoot:1,table:1};var e=this.startContainer,n=this.endContainer,s=e.getAscendant("table",!0),r=n.getAscendant("table",!0);return CKEDITOR.env.safari&&s&&n.equals(this.root)?e.getAscendant(t,!0):this.getEnclosedNode()?this.getEnclosedNode().getAscendant(t,!0):s&&r&&(s.equals(r)||s.contains(r)||r.contains(s))?e.getAscendant(t,!0):null},scrollIntoView:function(){var t,e,n,s=new CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",this.document),r=this.clone();r.optimize(),(n=r.startContainer.type==CKEDITOR.NODE_TEXT)?(e=r.startContainer.getText(),t=r.startContainer.split(r.startOffset),s.insertAfter(r.startContainer)):r.insertNode(s),s.scrollIntoView(),n&&(r.startContainer.setText(e),t.remove()),s.remove()},_setStartContainer:function(t){this.root.equals(t)||this.root.contains(t)||CKEDITOR.warn("range-startcontainer",{startContainer:t,root:this.root}),this.startContainer=t},_setEndContainer:function(t){this.root.equals(t)||this.root.contains(t)||CKEDITOR.warn("range-endcontainer",{endContainer:t,root:this.root}),this.endContainer=t},_find:function(t,e){var n,s,r,o,i,a=this.getCommonAncestor(),E=this.getBoundaryNodes(),T=[];if(a&&a.find)for(r=a.find(t),s=0;s<r.count();s++)n=r.getItem(s),!e&&n.isReadOnly()||(o=n.getPosition(E.startNode)&CKEDITOR.POSITION_FOLLOWING||E.startNode.equals(n),i=n.getPosition(E.endNode)&CKEDITOR.POSITION_PRECEDING+CKEDITOR.POSITION_IS_CONTAINED||E.endNode.equals(n),o&&i&&T.push(n));return T}},CKEDITOR.dom.range.mergeRanges=function(t){return CKEDITOR.tools.array.reduce(t,function(t,e){var n=t[t.length-1],s=!1;if((e=e.clone()).enlarge(CKEDITOR.ENLARGE_ELEMENT),n){var r,o=new CKEDITOR.dom.range(e.root),i=new CKEDITOR.dom.walker(o),a=CKEDITOR.dom.walker.whitespaces();for(o.setStart(n.endContainer,n.endOffset),o.setEnd(e.startContainer,e.startOffset),r=i.next();a(r)||e.endContainer.equals(r);)r=i.next();s=!r}return s?n.setEnd(e.endContainer,e.endOffset):t.push(e),t},[])}}(),CKEDITOR.POSITION_AFTER_START=1,CKEDITOR.POSITION_BEFORE_END=2,CKEDITOR.POSITION_BEFORE_START=3,CKEDITOR.POSITION_AFTER_END=4,CKEDITOR.ENLARGE_ELEMENT=1,CKEDITOR.ENLARGE_BLOCK_CONTENTS=2,CKEDITOR.ENLARGE_LIST_ITEM_CONTENTS=3,CKEDITOR.ENLARGE_INLINE=4,CKEDITOR.START=1,CKEDITOR.END=2,CKEDITOR.SHRINK_ELEMENT=1,CKEDITOR.SHRINK_TEXT=2;