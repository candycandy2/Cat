!function(){function e(e){var n,r=e.editor,i=e.data.path,s=i.blockLimit,c=e.data.selection,d=c.getRanges()[0];if(CKEDITOR.env.gecko||CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller){var E=t(c,i);E&&(E.appendBogus(),n=CKEDITOR.env.ie)}if(l(r,i.block,s)&&d.collapsed&&!d.getCommonAncestor().isReadOnly()){var u=d.clone();u.enlarge(CKEDITOR.ENLARGE_BLOCK_CONTENTS);var T=new CKEDITOR.dom.walker(u);if(T.guard=function(e){return!o(e)||e.type==CKEDITOR.NODE_COMMENT||e.isReadOnly()},!T.checkForward()||u.checkStartOfBlock()&&u.checkEndOfBlock()){var m=d.fixBlock(!0,r.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p");if(!CKEDITOR.env.needsBrFiller){var h=m.getFirst(o);h&&a(h)&&h.remove()}n=1,e.cancel()}}n&&d.select()}function t(e,t){if(e.isFake)return 0;var n=t.block||t.blockLimit,a=n&&n.getLast(o);return!n||!n.isBlockBoundary()||a&&a.type==CKEDITOR.NODE_ELEMENT&&a.isBlockBoundary()||n.is("pre")||n.getBogus()?void 0:n}function n(e){var t=e.data.getTarget();if(t.is("input")){var n=t.getAttribute("type");"submit"!=n&&"reset"!=n||e.data.preventDefault()}}function o(e){return m(e)&&h(e)}function a(e){return e.type==CKEDITOR.NODE_TEXT&&CKEDITOR.tools.trim(e.getText()).match(/^(?:&nbsp;|\xa0)$/)}function r(e,t){return function(n){var o=n.data.$.toElement||n.data.$.fromElement||n.data.$.relatedTarget;(o=o&&o.nodeType==CKEDITOR.NODE_ELEMENT?new CKEDITOR.dom.element(o):null)&&(t.equals(o)||t.contains(o))||e.call(this,n)}}function i(e){var t,n=e.getElementsByTag("span"),o=0;if(n)for(;t=n.getItem(o++);)if(!h(t))return!0;return!1}function s(e){function t(e){return function(t,a){if(a&&t.type==CKEDITOR.NODE_ELEMENT&&t.is(i)&&(n=t),!a&&o(t)&&(!e||!f(t)))return!1}}var n,a=e.getRanges()[0],r=e.root,i={table:1,ul:1,ol:1,dl:1};if(a.startPath().contains(i)){var s=a.clone();s.collapse(1),s.setStartAt(r,CKEDITOR.POSITION_AFTER_START);var l=new CKEDITOR.dom.walker(s);if(l.guard=t(),l.checkBackward(),n)return(s=a.clone()).collapse(),s.setEndAt(n,CKEDITOR.POSITION_AFTER_END),l=new CKEDITOR.dom.walker(s),l.guard=t(!0),n=!1,l.checkForward(),n}return null}function l(e,t,n){return!1!==e.config.autoParagraph&&e.activeEnterMode!=CKEDITOR.ENTER_BR&&(e.editable().equals(n)&&!t||t&&"true"==t.getAttribute("contenteditable"))}function c(e){return e.activeEnterMode!=CKEDITOR.ENTER_BR&&!1!==e.config.autoParagraph&&(e.activeEnterMode==CKEDITOR.ENTER_DIV?"div":"p")}function d(e){var t=e.editor;t.getSelection().scrollIntoView(),setTimeout(function(){t.fire("saveSnapshot")},0)}function E(e,t,n,o){var a=o.block;if(!a)return!1;if(!t[n?"checkStartOfBlock":"checkEndOfBlock"]())return!1;if(!t.moveToClosestEditablePosition(a,!n)||!t.collapsed)return!1;if(t.startContainer.type==CKEDITOR.NODE_ELEMENT){var r=t.startContainer.getChild(t.startOffset-(n?1:0));if(r&&r.type==CKEDITOR.NODE_ELEMENT&&r.is("hr"))return e.fire("saveSnapshot"),r.remove(),!0}var i=t.startPath().block;if(!(!i||i&&i.contains(a))){e.fire("saveSnapshot");var s;(s=(n?i:a).getBogus())&&s.remove();var l=e.getSelection(),c=l.createBookmarks();return(n?a:i).moveChildren(n?i:a,!1),o.lastElement.mergeSiblings(),T(a,i,!n),l.selectBookmarks(c),!0}}function u(e,t,n){var o=n.block,a=t.endPath().block;if(!o||!a||o.equals(a))return!1;e.fire("saveSnapshot");var r;return(r=o.getBogus())&&r.remove(),t.enlarge(CKEDITOR.ENLARGE_INLINE),t.deleteContents(),a.getParent()&&(a.moveChildren(o,!1),n.lastElement.mergeSiblings(),T(o,a,!0)),(t=e.getSelection().getRanges()[0]).collapse(1),t.optimize(),""===t.startContainer.getHtml()&&t.startContainer.appendBogus(),t.select(),!0}function T(e,t,n){for(var o=e.getCommonAncestor(t),a=n?t:e,r=a;(a=a.getParent())&&!o.equals(a)&&1==a.getChildCount();)r=a;r.remove()}var m,h,g,f,O,I,C,R,v,D;CKEDITOR.editable=CKEDITOR.tools.createClass({base:CKEDITOR.dom.element,$:function(e,t){this.base(t.$||t),this.editor=e,this.status="unloaded",this.hasFocus=!1,this.setup()},proto:{focus:function(){var e;if(CKEDITOR.env.webkit&&!this.hasFocus&&(e=this.editor._.previousActive||this.getDocument().getActive(),this.contains(e)))e.focus();else{CKEDITOR.env.edge&&CKEDITOR.env.version>14&&!this.hasFocus&&this.getDocument().equals(CKEDITOR.document)&&(this.editor._.previousScrollTop=this.$.scrollTop);try{if(!CKEDITOR.env.ie||CKEDITOR.env.edge&&CKEDITOR.env.version>14||!this.getDocument().equals(CKEDITOR.document))if(CKEDITOR.env.chrome){var t=this.$.scrollTop;this.$.focus(),this.$.scrollTop=t}else this.$.focus();else this.$.setActive()}catch(e){if(!CKEDITOR.env.ie)throw e}CKEDITOR.env.safari&&!this.isInline()&&((e=CKEDITOR.document.getActive()).equals(this.getWindow().getFrame())||this.getWindow().focus())}},on:function(e,t){var n=Array.prototype.slice.call(arguments,0);return CKEDITOR.env.ie&&/^focus|blur$/.exec(e)&&(e="focus"==e?"focusin":"focusout",t=r(t,this),n[0]=e,n[1]=t),CKEDITOR.dom.element.prototype.on.apply(this,n)},attachListener:function(e){!this._.listeners&&(this._.listeners=[]);var t=Array.prototype.slice.call(arguments,1),n=e.on.apply(e,t);return this._.listeners.push(n),n},clearListeners:function(){var e=this._.listeners;try{for(;e.length;)e.pop().removeListener()}catch(e){}},restoreAttrs:function(){var e,t=this._.attrChanges;for(var n in t)t.hasOwnProperty(n)&&(null!==(e=t[n])?this.setAttribute(n,e):this.removeAttribute(n))},attachClass:function(e){var t=this.getCustomData("classes");this.hasClass(e)||(!t&&(t=[]),t.push(e),this.setCustomData("classes",t),this.addClass(e))},changeAttr:function(e,t){var n=this.getAttribute(e);t!==n&&(!this._.attrChanges&&(this._.attrChanges={}),e in this._.attrChanges||(this._.attrChanges[e]=n),this.setAttribute(e,t))},insertText:function(e){this.editor.focus(),this.insertHtml(this.transformPlainTextToHtml(e),"text")},transformPlainTextToHtml:function(e){var t=this.editor.getSelection().getStartElement().hasAscendant("pre",!0)?CKEDITOR.ENTER_BR:this.editor.activeEnterMode;return CKEDITOR.tools.transformPlainTextToHtml(e,t)},insertHtml:function(e,t,n){var o=this.editor;o.focus(),o.fire("saveSnapshot"),n||(n=o.getSelection().getRanges()[0]),I(this,t||"html",e,n),n.select(),d(this),this.editor.fire("afterInsertHtml",{})},insertHtmlIntoRange:function(e,t,n){I(this,n||"html",e,t),this.editor.fire("afterInsertHtml",{intoRange:t})},insertElement:function(e,t){var n=this.editor;n.focus(),n.fire("saveSnapshot");var a=n.activeEnterMode,r=n.getSelection(),i=e.getName(),s=CKEDITOR.dtd.$block[i];if(t||(t=r.getRanges()[0]),this.insertElementIntoRange(e,t)&&(t.moveToPosition(e,CKEDITOR.POSITION_AFTER_END),s)){var l=e.getNext(function(e){return o(e)&&!f(e)});l&&l.type==CKEDITOR.NODE_ELEMENT&&l.is(CKEDITOR.dtd.$block)?l.getDtd()["#"]?t.moveToElementEditStart(l):t.moveToElementEditEnd(e):l||a==CKEDITOR.ENTER_BR||(l=t.fixBlock(!0,a==CKEDITOR.ENTER_DIV?"div":"p"),t.moveToElementEditStart(l))}r.selectRanges([t]),d(this)},insertElementIntoSelection:function(e){this.insertElement(e)},insertElementIntoRange:function(e,t){var n=this.editor,o=n.config.enterMode,a=e.getName(),r=CKEDITOR.dtd.$block[a];if(t.checkReadOnly())return!1;t.deleteContents(1),t.startContainer.type==CKEDITOR.NODE_ELEMENT&&(t.startContainer.is({tr:1,table:1,tbody:1,thead:1,tfoot:1})?C(t):t.startContainer.is(CKEDITOR.dtd.$list)&&R(t));var i,s;if(r)for(;(i=t.getCommonAncestor(0,1))&&(s=CKEDITOR.dtd[i.getName()])&&(!s||!s[a]);)i.getName()in CKEDITOR.dtd.span?t.splitElement(i):t.checkStartOfBlock()&&t.checkEndOfBlock()?(t.setStartBefore(i),t.collapse(!0),i.remove()):t.splitBlock(o==CKEDITOR.ENTER_DIV?"div":"p",n.editable());return t.insertNode(e),!0},setData:function(e,t){t||(e=this.editor.dataProcessor.toHtml(e)),this.setHtml(e),this.fixInitialSelection(),"unloaded"==this.status&&(this.status="ready"),this.editor.fire("dataReady")},getData:function(e){var t=this.getHtml();return e||(t=this.editor.dataProcessor.toDataFormat(t)),t},setReadOnly:function(e){this.setAttribute("contenteditable",!e)},detach:function(){this.removeClass("cke_editable"),this.status="detached";var e=this.editor;this._.detach(),delete e.document,delete e.window},isInline:function(){return this.getDocument().equals(CKEDITOR.document)},fixInitialSelection:function(){function e(){var e=n.getDocument().$,o=e.getSelection();if(t(o)){var a=new CKEDITOR.dom.range(n);a.moveToElementEditStart(n);var r=e.createRange();r.setStart(a.startContainer.$,a.startOffset),r.collapse(!0),o.removeAllRanges(),o.addRange(r)}}function t(e){if(e.anchorNode&&e.anchorNode==n.$)return!0;if(CKEDITOR.env.webkit){var t=n.getDocument().getActive();if(t&&t.equals(n)&&!e.anchorNode)return!0}}var n=this;CKEDITOR.env.ie&&(CKEDITOR.env.version<9||CKEDITOR.env.quirks)?this.hasFocus&&(this.focus(),function(){var e=n.getDocument().$,t=e.selection,o=n.getDocument().getActive();if("None"==t.type&&o.equals(n)){var a,r=new CKEDITOR.dom.range(n),i=e.body.createTextRange();r.moveToElementEditStart(n),(a=r.startContainer).type!=CKEDITOR.NODE_ELEMENT&&(a=a.getParent()),i.moveToElementText(a.$),i.collapse(!0),i.select()}}()):this.hasFocus?(this.focus(),e()):this.once("focus",function(){e()},null,null,-999)},getHtmlFromRange:function(e){if(e.collapsed)return new CKEDITOR.dom.documentFragment(e.document);var t={doc:this.getDocument(),range:e.clone()};return v.eol.detect(t,this),v.bogus.exclude(t),v.cell.shrink(t),t.fragment=t.range.cloneContents(),v.tree.rebuild(t,this),v.eol.fix(t,this),new CKEDITOR.dom.documentFragment(t.fragment.$)},extractHtmlFromRange:function(e,t){var n=D,o={range:e,doc:e.document},a=this.getHtmlFromRange(e);if(e.collapsed)return e.optimize(),a;e.enlarge(CKEDITOR.ENLARGE_INLINE,1),n.table.detectPurge(o),o.bookmark=e.createBookmark(),delete o.range;var r=this.editor.createRange();if(r.moveToPosition(o.bookmark.startNode,CKEDITOR.POSITION_BEFORE_START),o.targetBookmark=r.createBookmark(),n.list.detectMerge(o,this),n.table.detectRanges(o,this),n.block.detectMerge(o,this),o.tableContentsRanges?(n.table.deleteRanges(o),e.moveToBookmark(o.bookmark),o.range=e):(e.moveToBookmark(o.bookmark),o.range=e,e.extractContents(n.detectExtractMerge(o))),e.moveToBookmark(o.targetBookmark),e.optimize(),n.fixUneditableRangePosition(e),n.list.merge(o,this),n.table.purge(o,this),n.block.merge(o,this),t){var s=e.startPath();e.checkStartOfBlock()&&e.checkEndOfBlock()&&s.block&&!e.root.equals(s.block)&&!i(s.block)&&(e.moveToPosition(s.block,CKEDITOR.POSITION_BEFORE_START),s.block.remove())}else n.autoParagraph(this.editor,e),g(e.startContainer)&&e.startContainer.appendBogus();return e.startContainer.mergeSiblings(),a},setup:function(){var e=this.editor;if(this.attachListener(e,"beforeGetData",function(){var t=this.getData();this.is("textarea")||!1!==e.config.ignoreEmptyParagraph&&(t=t.replace(O,function(e,t){return t})),e.setData(t,null,1)},this),this.attachListener(e,"getSnapshot",function(e){e.data=this.getData(1)},this),this.attachListener(e,"afterSetData",function(){this.setData(e.getData(1))},this),this.attachListener(e,"loadSnapshot",function(e){this.setData(e.data,1)},this),this.attachListener(e,"beforeFocus",function(){var t=e.getSelection(),n=t&&t.getNative();n&&"Control"==n.type||this.focus()},this),this.attachListener(e,"insertHtml",function(e){this.insertHtml(e.data.dataValue,e.data.mode,e.data.range)},this),this.attachListener(e,"insertElement",function(e){this.insertElement(e.data)},this),this.attachListener(e,"insertText",function(e){this.insertText(e.data)},this),this.setReadOnly(e.readOnly),this.attachClass("cke_editable"),e.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?this.attachClass("cke_editable_inline"):e.elementMode!=CKEDITOR.ELEMENT_MODE_REPLACE&&e.elementMode!=CKEDITOR.ELEMENT_MODE_APPENDTO||this.attachClass("cke_editable_themed"),this.attachClass("cke_contents_"+e.config.contentsLangDirection),e.keystrokeHandler.blockedKeystrokes[8]=+e.readOnly,e.keystrokeHandler.attach(this),this.on("blur",function(){this.hasFocus=!1},null,null,-1),this.on("focus",function(){this.hasFocus=!0},null,null,-1),CKEDITOR.env.webkit&&this.on("scroll",function(){e._.previousScrollTop=e.editable().$.scrollTop},null,null,-1),CKEDITOR.env.edge&&CKEDITOR.env.version>14){var t=function(){var n=e.editable();null!=e._.previousScrollTop&&n.getDocument().equals(CKEDITOR.document)&&(n.$.scrollTop=e._.previousScrollTop,e._.previousScrollTop=null,this.removeListener("scroll",t))};this.on("scroll",t)}if(e.focusManager.add(this),this.equals(CKEDITOR.document.getActive())&&(this.hasFocus=!0,e.once("contentDom",function(){e.focusManager.focus(this)},this)),this.isInline()&&this.changeAttr("tabindex",e.tabIndex),!this.is("textarea")){e.document=this.getDocument(),e.window=this.getWindow();var a=e.document;this.changeAttr("spellcheck",!e.config.disableNativeSpellChecker);var r=e.config.contentsLangDirection;this.getDirection(1)!=r&&this.changeAttr("dir",r);var i=CKEDITOR.getCss();if(i){var l=a.getHead(),c=l.getCustomData("stylesheet");if(c)i!=c.getText()&&(CKEDITOR.env.ie&&CKEDITOR.env.version<9?c.$.styleSheet.cssText=i:c.setText(i));else{var d=a.appendStyleText(i);d=new CKEDITOR.dom.element(d.ownerNode||d.owningElement),l.setCustomData("stylesheet",d),d.data("cke-temp",1)}}var T=a.getCustomData("stylesheet_ref")||0;a.setCustomData("stylesheet_ref",T+1),this.setCustomData("cke_includeReadonly",!e.config.disableReadonlyStyling),this.attachListener(this,"click",function(e){e=e.data;var t=new CKEDITOR.dom.elementPath(e.getTarget(),this).contains("a");t&&2!=e.$.button&&t.isReadOnly()&&e.preventDefault()});var h={8:1,46:1};this.attachListener(e,"key",function(t){if(e.readOnly)return!0;var n,o=t.data.domEvent.getKey(),a=e.getSelection();if(0!==a.getRanges().length){if(o in h){var r,i,l,c,d=a.getRanges()[0],E=d.startPath(),u=8==o;CKEDITOR.env.ie&&CKEDITOR.env.version<11&&(r=a.getSelectedElement())||(r=s(a))?(e.fire("saveSnapshot"),d.moveToPosition(r,CKEDITOR.POSITION_BEFORE_START),r.remove(),d.select(),e.fire("saveSnapshot"),n=1):d.collapsed&&((i=E.block)&&(c=i[u?"getPrevious":"getNext"](m))&&c.type==CKEDITOR.NODE_ELEMENT&&c.is("table")&&d[u?"checkStartOfBlock":"checkEndOfBlock"]()?(e.fire("saveSnapshot"),d[u?"checkEndOfBlock":"checkStartOfBlock"]()&&i.remove(),d["moveToElementEdit"+(u?"End":"Start")](c),d.select(),e.fire("saveSnapshot"),n=1):E.blockLimit&&E.blockLimit.is("td")&&(l=E.blockLimit.getAscendant("table"))&&d.checkBoundaryOfElement(l,u?CKEDITOR.START:CKEDITOR.END)&&(c=l[u?"getPrevious":"getNext"](m))?(e.fire("saveSnapshot"),d["moveToElementEdit"+(u?"End":"Start")](c),d.checkStartOfBlock()&&d.checkEndOfBlock()?c.remove():d.select(),e.fire("saveSnapshot"),n=1):(l=E.contains(["td","th","caption"]))&&d.checkBoundaryOfElement(l,u?CKEDITOR.START:CKEDITOR.END)&&(n=1))}return!n}}),e.blockless&&CKEDITOR.env.ie&&CKEDITOR.env.needsBrFiller&&this.attachListener(this,"keyup",function(t){if(t.data.getKeystroke()in h&&!this.getFirst(o)){this.appendBogus();var n=e.createRange();n.moveToPosition(this,CKEDITOR.POSITION_AFTER_START),n.select()}}),this.attachListener(this,"dblclick",function(t){if(e.readOnly)return!1;var n={element:t.data.getTarget()};e.fire("doubleclick",n)}),CKEDITOR.env.ie&&this.attachListener(this,"click",n),CKEDITOR.env.ie&&!CKEDITOR.env.edge||this.attachListener(this,"mousedown",function(t){var n=t.data.getTarget();n.is("img","hr","input","textarea","select")&&!n.isReadOnly()&&(e.getSelection().selectElement(n),n.is("input","textarea","select")&&t.data.preventDefault())}),CKEDITOR.env.edge&&this.attachListener(this,"mouseup",function(t){var n=t.data.getTarget();n&&n.is("img")&&e.getSelection().selectElement(n)}),CKEDITOR.env.gecko&&this.attachListener(this,"mouseup",function(t){if(2==t.data.$.button){var n=t.data.getTarget();if(!n.getOuterHtml().replace(O,"")){var o=e.createRange();o.moveToElementEditStart(n),o.select(!0)}}}),CKEDITOR.env.webkit&&(this.attachListener(this,"click",function(e){e.data.getTarget().is("input","select")&&e.data.preventDefault()}),this.attachListener(this,"mouseup",function(e){e.data.getTarget().is("input","textarea")&&e.data.preventDefault()})),CKEDITOR.env.webkit&&this.attachListener(e,"key",function(t){if(e.readOnly)return!0;var n=t.data.domEvent.getKey();if(n in h){var o=e.getSelection();if(0!==o.getRanges().length){var a=8==n,r=o.getRanges()[0],i=r.startPath();if(r.collapsed){if(!E(e,r,a,i))return}else if(!u(e,r,i))return;return e.getSelection().scrollIntoView(),e.fire("saveSnapshot"),!1}}},this,null,100)}}},_:{detach:function(){this.editor.setData(this.editor.getData(),0,1),this.clearListeners(),this.restoreAttrs();var e;if(e=this.removeCustomData("classes"))for(;e.length;)this.removeClass(e.pop());if(!this.is("textarea")){var t=this.getDocument(),n=t.getHead();if(n.getCustomData("stylesheet")){var o=t.getCustomData("stylesheet_ref");--o?t.setCustomData("stylesheet_ref",o):(t.removeCustomData("stylesheet_ref"),n.removeCustomData("stylesheet").remove())}}this.editor.fire("contentDomUnload"),delete this.editor}}}),CKEDITOR.editor.prototype.editable=function(e){var t=this._.editable;return t&&e?0:(arguments.length&&(t=this._.editable=e?e instanceof CKEDITOR.editable?e:new CKEDITOR.editable(this,e):(t&&t.detach(),null)),t)},CKEDITOR.on("instanceLoaded",function(t){var n=t.editor;n.on("insertElement",function(e){var t=e.data;t.type==CKEDITOR.NODE_ELEMENT&&(t.is("input")||t.is("textarea"))&&("false"!=t.getAttribute("contentEditable")&&t.data("cke-editable",t.hasAttribute("contenteditable")?"true":"1"),t.setAttribute("contentEditable",!1))}),n.on("selectionChange",function(t){if(!n.readOnly){var o=n.getSelection();if(o&&!o.isLocked){var a=n.checkDirty();n.fire("lockSnapshot"),e(t),n.fire("unlockSnapshot"),!a&&n.resetDirty()}}})}),CKEDITOR.on("instanceCreated",function(e){var t=e.editor;t.on("mode",function(){var e=t.editable();if(e&&e.isInline()){var n=t.title;e.changeAttr("role","textbox"),e.changeAttr("aria-label",n),n&&e.changeAttr("title",n);var o=t.fire("ariaEditorHelpLabel",{}).label;if(o){var a=this.ui.space(this.elementMode==CKEDITOR.ELEMENT_MODE_INLINE?"top":"contents");if(a){var r=CKEDITOR.tools.getNextId(),i=CKEDITOR.dom.element.createFromHtml('<span id="'+r+'" class="cke_voice_label">'+o+"</span>");a.append(i),e.changeAttr("aria-describedby",r)}}}})}),CKEDITOR.addCss(".cke_editable{cursor:text}.cke_editable img,.cke_editable input,.cke_editable textarea{cursor:default}"),m=CKEDITOR.dom.walker.whitespaces(!0),h=CKEDITOR.dom.walker.bookmark(!1,!0),g=CKEDITOR.dom.walker.empty(),f=CKEDITOR.dom.walker.bogus(),O=/(^|<body\b[^>]*>)\s*<(p|div|address|h\d|center|pre)[^>]*>\s*(?:<br[^>]*>|&nbsp;|\u00A0|&#160;)?\s*(:?<\/\2>)?\s*(?=$|<\/body>)/gi,I=function(){"use strict";function e(e){var t,n,a,i,s,l,c,d=e.range,T=e.mergeCandidates;if("text"==e.type&&d.shrink(CKEDITOR.SHRINK_ELEMENT,!0,!1)&&(n=CKEDITOR.dom.element.createFromHtml("<span>&nbsp;</span>",d.document),d.insertNode(n),d.setStartAfter(n)),i=new CKEDITOR.dom.elementPath(d.startContainer),e.endPath=s=new CKEDITOR.dom.elementPath(d.endContainer),!d.collapsed){t=s.block||s.blockLimit;var h=d.getCommonAncestor();t&&!t.equals(h)&&!t.contains(h)&&d.checkEndOfBlock()&&e.zombies.push(t),d.deleteContents()}for(;(l=E(d))&&r(l)&&l.isBlockBoundary()&&i.contains(l);)d.moveToPosition(l,CKEDITOR.POSITION_BEFORE_END);for(m(d,e.blockLimit,i,s),n&&(d.setEndBefore(n),d.collapse(),n.remove()),(t=(a=d.startPath()).contains(u,!1,1))&&(d.splitElement(t),e.inlineStylesRoot=t,e.inlineStylesPeak=a.lastElement),(t=(c=d.createBookmark()).startNode.getPrevious(o))&&r(t)&&u(t)&&T.push(t),(t=c.startNode.getNext(o))&&r(t)&&u(t)&&T.push(t),t=c.startNode;(t=t.getParent())&&u(t);)T.push(t);d.moveToBookmark(c)}function t(e,t){var n=e.range;"text"==e.type&&e.inlineStylesRoot&&(t=O(t,e));var o=e.blockLimit.getName();if(/^\s+|\s+$/.test(t)&&"span"in CKEDITOR.dtd[o]){var a='<span data-cke-marker="1">&nbsp;</span>';t=a+t+a}t=e.editor.dataProcessor.toHtml(t,{context:null,fixForBody:!1,protectedWhitespaces:!!a,dontFilter:e.dontFilter,filter:e.editor.activeFilter,enterMode:e.editor.activeEnterMode});var r=n.document.createElement("body");r.setHtml(t),a&&(r.getFirst().remove(),r.getLast().remove());var i=n.startPath().block;return!i||1==i.getChildCount()&&i.getBogus()||f(r),e.dataWrapper=r,t}function n(e){var t,n,o,a,r,d,E,u,m,f,O,C=e.range,R=C.document,v=e.blockLimit,D=0,k=[],p=0,K=0,b=C.startContainer,N=e.endPath.elements[0],S=N.getPosition(b),_=!(!N.getCommonAncestor(b)||S==CKEDITOR.POSITION_IDENTICAL||S&CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED);for(h(n=i(e.dataWrapper,e),C);D<n.length;D++)if((o=n[D]).isLineBreak&&g(C,v,o))K=D>0;else{if(t=C.startPath(),!o.isBlock&&l(e.editor,t.block,t.blockLimit)&&(E=c(e.editor))&&((E=R.createElement(E)).appendBogus(),C.insertNode(E),CKEDITOR.env.needsBrFiller&&(r=E.getBogus())&&r.remove(),C.moveToPosition(E,CKEDITOR.POSITION_BEFORE_END)),(a=C.startPath().block)&&!a.equals(d)&&((r=a.getBogus())&&(r.remove(),k.push(a)),d=a),o.firstNotAllowed&&(p=1),p&&o.isElement){for(u=C.startContainer,m=null;u&&!I[u.getName()][o.name];){if(u.equals(v)){u=null;break}m=u,u=u.getParent()}u?m&&(f=C.splitElement(m),e.zombies.push(f),e.zombies.push(m)):O=s(o.node,v.getName(),!D,D==n.length-1)}if(O){for(;a=O.pop();)C.insertNode(a);O=0}else C.insertNode(o.node);o.lastNotAllowed&&D<n.length-1&&((f=_?N:f)&&C.setEndAt(f,CKEDITOR.POSITION_AFTER_START),p=0),C.collapse()}T(n)&&(K=!0,a=n[0].node,C.setStartAt(a,CKEDITOR.POSITION_BEFORE_START),C.setEndAt(a,CKEDITOR.POSITION_AFTER_END)),e.dontMoveCaret=K,e.bogusNeededBlocks=k}function a(e){for(var t,n,a,i=e.range,s=e.bogusNeededBlocks,l=i.createBookmark();t=e.zombies.pop();)t.getParent()&&((n=i.clone()).moveToElementEditStart(t),n.removeEmptyBlocksAtEnd());if(s)for(;t=s.pop();)CKEDITOR.env.needsBrFiller?t.appendBogus():t.append(i.document.createText("Â "));for(;t=e.mergeCandidates.pop();)t.mergeSiblings();if(i.moveToBookmark(l),!e.dontMoveCaret){for(t=E(i);t&&r(t)&&!t.is(I.$empty);){if(t.isBlockBoundary())i.moveToPosition(t,CKEDITOR.POSITION_BEFORE_END);else{if(u(t)&&t.getHtml().match(/(\s|&nbsp;)$/g)){a=null;break}(a=i.clone()).moveToPosition(t,CKEDITOR.POSITION_BEFORE_END)}t=t.getLast(o)}a&&i.moveToRange(a)}}function r(e){return e.type==CKEDITOR.NODE_ELEMENT}function i(e,t){for(var n,o,a,s,l,c=[],d=t.range.startContainer,E=t.range.startPath(),u=I[d.getName()],T=0,m=e.getChildren(),h=m.count(),g=-1,f=-1,O=0,C=E.contains(I.$list);T<h;++T)if(n=m.getItem(T),r(n)){if(a=n.getName(),C&&a in CKEDITOR.dtd.$list){c=c.concat(i(n,t));continue}s=!!u[a],"br"!=a||!n.data("cke-eol")||T&&T!=h-1||(O=(o=T?c[T-1].node:m.getItem(T+1))&&(!r(o)||!o.is("br")),l=o&&r(o)&&I.$block[o.getName()]),-1!=g||s||(g=T),s||(f=T),c.push({isElement:1,isLineBreak:O,isBlock:n.isBlockBoundary(),hasBlockSibling:l,node:n,name:a,allowed:s}),O=0,l=0}else c.push({isElement:0,node:n,allowed:1});return g>-1&&(c[g].firstNotAllowed=1),f>-1&&(c[f].lastNotAllowed=1),c}function s(e,t,n,o){for(var a,r=d(e,t),i=[],s=r.length,l=0,c=0,E=-1;l<s;l++)" "==(a=r[l])?(c||n&&!l||(i.push(new CKEDITOR.dom.text(" ")),E=i.length),c=1):(i.push(a),c=0);return o&&E==i.length&&i.pop(),i}function d(e,t){var n,o=[],a=e.getChildren(),i=a.count(),s=0,l=I[t],c=!e.is(I.$inline)||e.is("br");for(c&&o.push(" ");s<i;s++)r(n=a.getItem(s))&&!n.is(l)?o=o.concat(d(n,t)):o.push(n);return c&&o.push(" "),o}function E(e){return r(e.startContainer)&&e.startContainer.getChild(e.startOffset-1)}function u(e){return e&&r(e)&&(e.is(I.$removeEmpty)||e.is("a")&&!e.isBlockBoundary())}function T(e){if(1!=e.length)return!1;var t=e[0];return t.isElement&&"false"==t.node.getAttribute("contenteditable")}function m(e,t,n,o){var a,i,s=e.clone();s.setEndAt(t,CKEDITOR.POSITION_BEFORE_END),(a=new CKEDITOR.dom.walker(s).next())&&r(a)&&C[a.getName()]&&(i=a.getPrevious())&&r(i)&&!i.getParent().equals(e.startContainer)&&n.contains(i)&&o.contains(a)&&a.isIdentical(i)&&(a.moveChildren(i),a.remove(),m(e,t,n,o))}function h(e,t){function n(e,t){if(t.isBlock&&t.isElement&&!t.node.is("br")&&r(e)&&e.is("br"))return e.remove(),1}var o=t.endContainer.getChild(t.endOffset),a=t.endContainer.getChild(t.endOffset-1);o&&n(o,e[e.length-1]),a&&n(a,e[0])&&(t.setEnd(t.endContainer,t.endOffset-1),t.collapse())}function g(e,t,n){var o,a;if(n.hasBlockSibling)return 1;if(!(o=e.startContainer.getAscendant(I.$block,1))||!o.is({div:1,p:1}))return 0;if((a=o.getPosition(t))==CKEDITOR.POSITION_IDENTICAL||a==CKEDITOR.POSITION_CONTAINS)return 0;var r=e.splitElement(o);return e.moveToPosition(r,CKEDITOR.POSITION_AFTER_START),1}function f(e){var t,n;if(1==e.getChildCount()&&r(t=e.getFirst())&&t.is(R)&&!t.hasAttribute("contenteditable")){for(var o=0,a=(n=t.getElementsByTag("*")).count();o<a;o++)if(!n.getItem(o).is(v))return;t.moveChildren(t.getParent(1)),t.remove()}}function O(e,t){for(var n=t.inlineStylesPeak,o=n.getDocument().createText("{cke-peak}"),a=t.inlineStylesRoot.getParent();!n.equals(a);)o=o.appendTo(n.clone()),n=n.getParent();return o.getOuterHtml().split("{cke-peak}").join(e)}var I=CKEDITOR.dtd,C={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,ul:1,ol:1,li:1,pre:1,dl:1,blockquote:1},R={p:1,div:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},v=CKEDITOR.tools.extend({},I.$inline);return delete v.br,function(o,r,i,s){var l=o.editor,c=!1;if("unfiltered_html"==r&&(r="html",c=!0),!s.checkReadOnly()){var d={type:r,dontFilter:c,editable:o,editor:l,range:s,blockLimit:new CKEDITOR.dom.elementPath(s.startContainer,s.root).blockLimit||s.root,mergeCandidates:[],zombies:[]};e(d),i&&t(d,i)&&n(d),a(d)}}}(),C=function(){function e(e){var t=new CKEDITOR.dom.walker(e);return t.guard=function(e,t){return!t&&(e.type==CKEDITOR.NODE_ELEMENT?e.is(CKEDITOR.dtd.$tableContent):void 0)},t.evaluator=function(e){return e.type==CKEDITOR.NODE_ELEMENT},t}function t(e,t,n){var o=e.getDocument().createElement(t);return e.append(o,n),o}function n(e){var t,n=e.count();for(n;n-- >0;)t=e.getItem(n),CKEDITOR.tools.trim(t.getHtml())||(t.appendBogus(),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&t.getChildCount()&&t.getFirst().remove())}return function(o){var a,r,i=o.startContainer,s=i.getAscendant("table",1),l=!1;if(n(s.getElementsByTag("td")),n(s.getElementsByTag("th")),(a=o.clone()).setStart(i,0),(r=e(a).lastBackward())||((a=o.clone()).setEndAt(i,CKEDITOR.POSITION_BEFORE_END),r=e(a).lastForward(),l=!0),r||(r=i),r.is("table"))return o.setStartAt(r,CKEDITOR.POSITION_BEFORE_START),o.collapse(!0),void r.remove();r.is({tbody:1,thead:1,tfoot:1})&&(r=t(r,"tr",l)),r.is("tr")&&(r=t(r,r.getParent().is("thead")?"th":"td",l));var c=r.getBogus();c&&c.remove(),o.moveToPosition(r,l?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END)}}(),R=function(){function e(e){var t=new CKEDITOR.dom.walker(e);return t.guard=function(e,t){return!t&&(e.type==CKEDITOR.NODE_ELEMENT?e.is(CKEDITOR.dtd.$list)||e.is(CKEDITOR.dtd.$listItem):void 0)},t.evaluator=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.is(CKEDITOR.dtd.$listItem)},t}return function(t){var n,o,a=t.startContainer,r=!1;if((n=t.clone()).setStart(a,0),(o=e(n).lastBackward())||((n=t.clone()).setEndAt(a,CKEDITOR.POSITION_BEFORE_END),o=e(n).lastForward(),r=!0),o||(o=a),o.is(CKEDITOR.dtd.$list))return t.setStartAt(o,CKEDITOR.POSITION_BEFORE_START),t.collapse(!0),void o.remove();var i=o.getBogus();i&&i.remove(),t.moveToPosition(o,r?CKEDITOR.POSITION_AFTER_START:CKEDITOR.POSITION_BEFORE_END),t.select()}}(),v={eol:{detect:function(e,t){var n=e.range,o=n.clone(),a=n.clone(),r=new CKEDITOR.dom.elementPath(n.startContainer,t),i=new CKEDITOR.dom.elementPath(n.endContainer,t);o.collapse(1),a.collapse(),r.block&&o.checkBoundaryOfElement(r.block,CKEDITOR.END)&&(n.setStartAfter(r.block),e.prependEolBr=1),i.block&&a.checkBoundaryOfElement(i.block,CKEDITOR.START)&&(n.setEndBefore(i.block),e.appendEolBr=1)},fix:function(e,t){var n,o=t.getDocument();e.appendEolBr&&(n=this.createEolBr(o),e.fragment.append(n)),!e.prependEolBr||n&&!n.getPrevious()||e.fragment.append(this.createEolBr(o),1)},createEolBr:function(e){return e.createElement("br",{attributes:{"data-cke-eol":1}})}},bogus:{exclude:function(e){var t=e.range.getBoundaryNodes(),n=t.startNode,o=t.endNode;!o||!f(o)||n&&n.equals(o)||e.range.setEndBefore(o)}},tree:{rebuild:function(e,t){var n,o=e.range,a=o.getCommonAncestor(),r=new CKEDITOR.dom.elementPath(a,t),i=new CKEDITOR.dom.elementPath(o.startContainer,t),s=new CKEDITOR.dom.elementPath(o.endContainer,t);if(a.type==CKEDITOR.NODE_TEXT&&(a=a.getParent()),r.blockLimit.is({tr:1,table:1})){var l=r.contains("table").getParent();n=function(e){return!e.equals(l)}}else if(r.block&&r.block.is(CKEDITOR.dtd.$listItem)){var c=i.contains(CKEDITOR.dtd.$list),d=s.contains(CKEDITOR.dtd.$list);if(!c.equals(d)){var E=r.contains(CKEDITOR.dtd.$list).getParent();n=function(e){return!e.equals(E)}}}n||(n=function(e){return!e.equals(r.block)&&!e.equals(r.blockLimit)}),this.rebuildFragment(e,t,a,n)},rebuildFragment:function(e,t,n,o){for(var a;n&&!n.equals(t)&&o(n);)a=n.clone(0,1),e.fragment.appendTo(a),e.fragment=a,n=n.getParent()}},cell:{shrink:function(e){var t=e.range,n=t.startContainer,o=t.endContainer,a=t.startOffset,r=t.endOffset;n.type==CKEDITOR.NODE_ELEMENT&&n.equals(o)&&n.is("tr")&&++a==r&&t.shrink(CKEDITOR.SHRINK_TEXT)}}},D=function(){function e(e,t){var n=e.getParent();n.is(CKEDITOR.dtd.$inline)&&e[t?"insertBefore":"insertAfter"](n)}function t(t,n,o){e(n),e(o,1);for(var a;a=o.getNext();)a.insertAfter(n),n=a;g(t)&&t.remove()}function n(e,t){return new CKEDITOR.dom.elementPath(e,t)}function o(e,t){var n=new CKEDITOR.dom.range(e);return n.setStartAfter(t.startNode),n.setEndBefore(t.endNode),n}return{list:{detectMerge:function(e,t){var n=o(t,e.bookmark),a=n.startPath(),r=n.endPath(),i=a.contains(CKEDITOR.dtd.$list),s=r.contains(CKEDITOR.dtd.$list);if(e.mergeList=i&&s&&i.getParent().equals(s.getParent())&&!i.equals(s),e.mergeListItems=a.block&&r.block&&a.block.is(CKEDITOR.dtd.$listItem)&&r.block.is(CKEDITOR.dtd.$listItem),e.mergeList||e.mergeListItems){var l=n.clone();l.setStartBefore(e.bookmark.startNode),l.setEndAfter(e.bookmark.endNode),e.mergeListBookmark=l.createBookmark()}},merge:function(e,o){if(e.mergeListBookmark){var a=e.mergeListBookmark.startNode,r=e.mergeListBookmark.endNode,i=n(a,o),s=n(r,o);if(e.mergeList){var l=i.contains(CKEDITOR.dtd.$list),c=s.contains(CKEDITOR.dtd.$list);l.equals(c)||(c.moveChildren(l),c.remove())}if(e.mergeListItems){var d=i.contains(CKEDITOR.dtd.$listItem),E=s.contains(CKEDITOR.dtd.$listItem);d.equals(E)||t(E,a,r)}a.remove(),r.remove()}}},block:{detectMerge:function(e,t){if(!e.tableContentsRanges&&!e.mergeListBookmark){var n=new CKEDITOR.dom.range(t);n.setStartBefore(e.bookmark.startNode),n.setEndAfter(e.bookmark.endNode),e.mergeBlockBookmark=n.createBookmark()}},merge:function(e,o){if(e.mergeBlockBookmark&&!e.purgeTableBookmark){var a=e.mergeBlockBookmark.startNode,r=e.mergeBlockBookmark.endNode,i=n(a,o),s=n(r,o),l=i.block,c=s.block;l&&c&&!l.equals(c)&&t(c,a,r),a.remove(),r.remove()}}},table:function(){function e(e){function t(e){if(e.is(a)){var t=l&&l.getAscendant("table",!0),n=c&&c.getAscendant("table",!0),o=e.getAscendant("table",!0);return t&&t.contains(o)||n&&n.contains(o)}}function o(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.is(a)&&(!l||n(e,l))&&(!c||n(e,c))}var r,i=[],s=new CKEDITOR.dom.walker(e),l=e.startPath().contains(a),c=e.endPath().contains(a),d={};return s.guard=function(n,a){if(n.type==CKEDITOR.NODE_ELEMENT){var s="visited_"+(a?"out":"in");if(n.getCustomData(s))return;CKEDITOR.dom.element.setMarker(d,n,s,1)}return a&&l&&n.equals(l)?((r=e.clone()).setEndAt(l,CKEDITOR.POSITION_BEFORE_END),void i.push(r)):!a&&c&&n.equals(c)?((r=e.clone()).setStartAt(c,CKEDITOR.POSITION_AFTER_START),void i.push(r)):void((!a&&o(n)||a&&t(n))&&((r=e.clone()).selectNodeContents(n),i.push(r)))},s.lastForward(),CKEDITOR.dom.element.clearAllMarkers(d),i}function t(e){var t=e.getCommonAncestor();return t.is(CKEDITOR.dtd.$tableContent)&&!t.is(a)&&(t=t.getAscendant("table",!0)),t}function n(e,t){var n=CKEDITOR.POSITION_CONTAINS+CKEDITOR.POSITION_IS_CONTAINED,o=e.getPosition(t);return o!==CKEDITOR.POSITION_IDENTICAL&&0==(o&n)}var a={td:1,th:1,caption:1};return{detectPurge:function(e){var t=e.range,n=t.clone();n.enlarge(CKEDITOR.ENLARGE_ELEMENT);var o=new CKEDITOR.dom.walker(n),r=0;if(o.evaluator=function(e){e.type==CKEDITOR.NODE_ELEMENT&&e.is(a)&&++r},o.checkForward(),r>1){var i=t.startPath().contains("table"),s=t.endPath().contains("table");if(i&&s&&t.checkBoundaryOfElement(i,CKEDITOR.START)&&t.checkBoundaryOfElement(s,CKEDITOR.END)){var l=e.range.clone();l.setStartBefore(i),l.setEndAfter(s),e.purgeTableBookmark=l.createBookmark()}}},detectRanges:function(a,r){var i,s,l,c=o(r,a.bookmark),d=c.clone(),E=t(c),u=new CKEDITOR.dom.elementPath(c.startContainer,E),T=new CKEDITOR.dom.elementPath(c.endContainer,E),m=u.contains("table"),h=T.contains("table");(m||h)&&(m&&h&&n(m,h)?(a.tableSurroundingRange=d,d.setStartAt(m,CKEDITOR.POSITION_AFTER_END),d.setEndAt(h,CKEDITOR.POSITION_BEFORE_START),(i=c.clone()).setEndAt(m,CKEDITOR.POSITION_AFTER_END),(s=c.clone()).setStartAt(h,CKEDITOR.POSITION_BEFORE_START),l=e(i).concat(e(s))):m?h||(a.tableSurroundingRange=d,d.setStartAt(m,CKEDITOR.POSITION_AFTER_END),c.setEndAt(m,CKEDITOR.POSITION_AFTER_END)):(a.tableSurroundingRange=d,d.setEndAt(h,CKEDITOR.POSITION_BEFORE_START),c.setStartAt(h,CKEDITOR.POSITION_AFTER_START)),a.tableContentsRanges=l||e(c))},deleteRanges:function(e){for(var t;t=e.tableContentsRanges.pop();)t.extractContents(),g(t.startContainer)&&t.startContainer.appendBogus();e.tableSurroundingRange&&e.tableSurroundingRange.extractContents()},purge:function(e){if(e.purgeTableBookmark){var t=e.doc,n=e.range.clone(),o=t.createElement("p");o.insertBefore(e.purgeTableBookmark.startNode),n.moveToBookmark(e.purgeTableBookmark),n.deleteContents(),e.range.moveToPosition(o,CKEDITOR.POSITION_AFTER_START)}}}}(),detectExtractMerge:function(e){return!(e.range.startPath().contains(CKEDITOR.dtd.$listItem)&&e.range.endPath().contains(CKEDITOR.dtd.$listItem))},fixUneditableRangePosition:function(e){e.startContainer.getDtd()["#"]||e.moveToClosestEditablePosition(null,!0)},autoParagraph:function(e,t){var n,o=t.startPath();l(e,o.block,o.blockLimit)&&(n=c(e))&&((n=t.document.createElement(n)).appendBogus(),t.insertNode(n),t.moveToPosition(n,CKEDITOR.POSITION_AFTER_START))}}}()}();