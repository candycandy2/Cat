!function(){function e(e){return CKEDITOR.plugins.widget&&CKEDITOR.plugins.widget.isDomWidget(e)}function t(t,n){if(0===t.length)return!1;if(e(t[0].getEnclosedNode()))return!1;var o;if(!n&&1===t.length&&(t[0].collapsed||function(e){var t,n=e.startContainer.getAscendant({td:1,th:1},!0),o=e.endContainer.getAscendant({td:1,th:1},!0),i=CKEDITOR.tools.trim;return!(!n||!n.equals(o)||n.findOne("td, th, tr, tbody, table")||(t=e.cloneContents()).getFirst()&&i(t.getFirst().getText())===i(n.getText()))}(t[0])))return!1;for(o=0;o<t.length;o++)if(!t[o]._getTableElement())return!1;return!0}function n(n,o){function i(e,t){return!(!e||!t)&&(e.equals(t)||t.contains(e))}var r=n.getRanges(),a=o.getRanges(),s=r.length&&r[0]._getTableElement()&&r[0]._getTableElement().getAscendant("table",!0),l=a.length&&a[0]._getTableElement()&&a[0]._getTableElement().getAscendant("table",!0),c=1===r.length&&r[0]._getTableElement()&&r[0]._getTableElement().is("table"),E=1===a.length&&a[0]._getTableElement()&&a[0]._getTableElement().is("table");return!e(o.getSelectedElement())&&(!!function(e,n,o,r){var a=1===o.length&&o[0].collapsed,s=t(o,!!CKEDITOR.env.webkit)&&t(r);return i(e,n)&&(a||s)}(s,l,r,a)&&(c&&!E&&o.selectRanges(r),!0))}function o(e){var t,n,o=[];for(n=0;n<e.length;n++)(t=e[n]._getTableElement()).is&&t.is({td:1,th:1})?o.push(t):o=o.concat(function(e){var t,n=e.find("td, th"),o=[];for(t=0;t<n.count();t++)o.push(n.getItem(t));return o}(t));return o}function i(e){var t,n,i=o(e),r="",a=[];for(n=0;n<i.length;n++)t&&!t.equals(i[n].getAscendant("tr"))?(r+=a.join("\t")+"\n",t=i[n].getAscendant("tr"),a=[]):0===n&&(t=i[n].getAscendant("tr")),a.push(i[n].getText());return r+=a.join("\t")}function r(e){var t,n=this.root.editor,o=n.getSelection(1);this.reset(),I=!0,o.root.once("selectionchange",function(e){e.cancel()},null,null,0),o.selectRanges([e[0]]),(t=this._.cache).ranges=new CKEDITOR.dom.rangeList(e),t.type=CKEDITOR.SELECTION_TEXT,t.selectedElement=e[0]._getTableElement(),t.selectedText=i(e),t.nativeSel=null,this.isFake=1,this.rev=K++,n._.fakeSelection=this,I=!1,this.root.fire("selectionchange")}function a(){var e,t=this._.fakeSelection;if(t&&((e=this.getSelection(1))&&(e.isHidden()||n(e,t))||(t.reset(),t=0)),t||(t=e||this.getSelection(1))&&t.getType()!=CKEDITOR.SELECTION_NONE){this.fire("selectionCheck",t);var o=this.elementPath();if(!o.compare(this._.selectionPreviousPath)){var i=this._.selectionPreviousPath&&this._.selectionPreviousPath.blockLimit.equals(o.blockLimit);CKEDITOR.env.webkit&&!i&&(this._.previousActive=this.document.getActive()),this._.selectionPreviousPath=o,this.fire("selectionChange",{selection:t,path:o})}}}function s(){N=!0,p||(l.call(this),p=CKEDITOR.tools.setTimeout(l,200,this))}function l(){p=null,N&&(CKEDITOR.tools.setTimeout(a,0,this),N=!1)}function c(e){return!!y(e)||e.type==CKEDITOR.NODE_ELEMENT&&!e.is(CKEDITOR.dtd.$empty)}function E(e){function t(t,n){return!(!t||t.type==CKEDITOR.NODE_TEXT)&&e.clone()["moveToElementEdit"+(n?"End":"Start")](t)}if(!(e.root instanceof CKEDITOR.editable))return!1;var n=e.startContainer,o=e.getPreviousNode(c,null,n),i=e.getNextNode(c,null,n);return!(!t(o)&&!t(i,1))||!(o||i||n.type==CKEDITOR.NODE_ELEMENT&&n.isBlockBoundary()&&n.getBogus())}function d(e){f(e,!1);var t=e.getDocument().createText(_);return e.setCustomData("cke-fillingChar",t),t}function u(e){var t=e.getCustomData("cke-fillingChar");t&&(t.getCustomData("ready")?(f(e),e.editor.fire("selectionCheck")):t.setCustomData("ready",1))}function f(e,t){var n=e&&e.removeCustomData("cke-fillingChar");if(n){if(!1!==t){var o=e.getDocument().getSelection().getNative(),i=o&&"None"!=o.type&&o.getRangeAt(0),r=_.length;if(n.getLength()>r&&i&&i.intersectsNode(n.$)){var a=h(o);o.anchorNode==n.$&&o.anchorOffset>r&&(a[0].offset-=r),o.focusNode==n.$&&o.focusOffset>r&&(a[1].offset-=r)}}n.setText(g(n.getText(),1)),a&&T(e.getDocument().$,a)}}function g(e,t){return t?e.replace(k,function(e,t){return t?" ":""}):e.replace(_,"")}function h(e){return[{node:e.anchorNode,offset:e.anchorOffset},{node:e.focusNode,offset:e.focusOffset}]}function T(e,t){var n=e.getSelection(),o=e.createRange();o.setStart(t[0].node,t[0].offset),o.collapse(!0),n.removeAllRanges(),n.addRange(o),n.extend(t[1].node,t[1].offset)}function C(e,t){var n=t||"&nbsp;",o=CKEDITOR.env.ie&&CKEDITOR.env.version<14?"display:none":"position:fixed;top:0;left:-1000px",i=CKEDITOR.dom.element.createFromHtml('<div data-cke-hidden-sel="1" data-cke-temp="1" style="'+o+'">'+n+"</div>",e.document);e.fire("lockSnapshot"),e.editable().append(i);var r=e.getSelection(1),a=e.createRange(),s=r.root.on("selectionchange",function(e){e.cancel()},null,null,0);a.setStartAt(i,CKEDITOR.POSITION_AFTER_START),a.setEndAt(i,CKEDITOR.POSITION_BEFORE_END),r.selectRanges([a]),s.removeListener(),e.fire("unlockSnapshot"),e._.hiddenSelectionContainer=i}function O(e){var t=e._.hiddenSelectionContainer;if(t){var n=e.checkDirty();e.fire("lockSnapshot"),t.remove(),e.fire("unlockSnapshot"),!n&&e.resetDirty()}delete e._.hiddenSelectionContainer}function v(e){var t={37:1,39:1,8:1,46:1};return function(n){var o=n.data.getKeystroke();if(t[o]){var i=e.getSelection().getRanges(),r=i[0];if(1==i.length&&r.collapsed){var a=r[o<38?"getPreviousEditableNode":"getNextEditableNode"]();a&&a.type==CKEDITOR.NODE_ELEMENT&&"false"==a.getAttribute("contenteditable")&&(e.getSelection().fake(a),n.data.preventDefault(),n.cancel())}}}}function m(e){var t,n,o,i;if(1==e.length&&!(i=e[0]).collapsed&&(t=i.getEnclosedNode())&&t.type==CKEDITOR.NODE_ELEMENT&&((o=i.clone()).shrink(CKEDITOR.SHRINK_ELEMENT,!0),(n=o.getEnclosedNode())&&n.type==CKEDITOR.NODE_ELEMENT&&(t=n),"false"==t.getAttribute("contenteditable")))return t}function R(e,t){for(var n,o=0;o<e.length;++o)(n=e[o]).endContainer.equals(t)&&(n.endOffset=Math.min(n.endOffset,t.getChildCount()))}function D(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.getCommonAncestor().isReadOnly()&&e.splice(t,1),!n.collapsed){if(n.startContainer.isReadOnly())for(var o,i=n.startContainer;i&&!((o=i.type==CKEDITOR.NODE_ELEMENT)&&i.is("body")||!i.isReadOnly());)o&&"false"==i.getAttribute("contentEditable")&&n.setStartAfter(i),i=i.getParent();var r=n.startContainer,a=n.endContainer,s=n.startOffset,l=n.endOffset,c=n.clone();r&&r.type==CKEDITOR.NODE_TEXT&&(s>=r.getLength()?c.setStartAfter(r):c.setStartBefore(r)),a&&a.type==CKEDITOR.NODE_TEXT&&(l?c.setEndAfter(a):c.setEndBefore(a));var E=new CKEDITOR.dom.walker(c);E.evaluator=function(o){if(o.type==CKEDITOR.NODE_ELEMENT&&o.isReadOnly()){var i=n.clone();return n.setEndBefore(o),n.collapsed&&e.splice(t--,1),o.getPosition(c.endContainer)&CKEDITOR.POSITION_CONTAINS||(i.setStartAfter(o),i.collapsed||e.splice(t+1,0,i)),!0}return!1},E.next()}}return e}var I,p,N,S="function"!=typeof window.getSelection,K=1,_=CKEDITOR.tools.repeat("​",7),k=new RegExp(_+"( )?","g"),y=CKEDITOR.dom.walker.invisible(1),L=function(){function e(e){return function(t){var n=t.editor.createRange();return n.moveToClosestEditablePosition(t.selected,e)&&t.editor.getSelection().selectRanges([n]),!1}}function t(e){return function(t){var n,o=t.editor,i=o.createRange();return(n=i.moveToClosestEditablePosition(t.selected,e))||(n=i.moveToClosestEditablePosition(t.selected,!e)),n&&o.getSelection().selectRanges([i]),o.fire("saveSnapshot"),t.selected.remove(),n||(i.moveToElementEditablePosition(o.editable()),o.getSelection().selectRanges([i])),o.fire("saveSnapshot"),!1}}var n=e(),o=e(1);return{37:n,38:n,39:o,40:o,8:t(),46:t(1)}}();CKEDITOR.on("instanceCreated",function(e){function t(){var e=n.getSelection();e&&e.removeAllRanges()}var n=e.editor;n.on("contentDom",function(){function e(){(c=new CKEDITOR.dom.selection(n.getSelection())).lock()}function t(e,t,n){try{e.moveToPoint(t,n)}catch(e){}}function o(){d.removeListener("mouseup",i),h.removeListener("mouseup",i)}function i(){o();var e=CKEDITOR.document.$.selection,t=e.createRange();"None"!=e.type&&t.parentElement()&&t.parentElement().ownerDocument==E.$&&t.select()}function r(e){if(CKEDITOR.env.ie){var t=e.getRanges()[0],n=t?t.startContainer.getAscendant(function(e){return e.type==CKEDITOR.NODE_ELEMENT&&("false"==e.getAttribute("contenteditable")||"true"==e.getAttribute("contenteditable"))},!0):null;return t&&"false"==n.getAttribute("contenteditable")&&n}}var l,c,E=n.document,d=CKEDITOR.document,u=n.editable(),g=E.getBody(),h=E.getDocumentElement(),T=u.isInline();if(CKEDITOR.env.gecko&&u.attachListener(u,"focus",function(e){if(e.removeListener(),0!==l){var t=n.getSelection().getNative();if(t&&t.isCollapsed&&t.anchorNode==u.$){var o=n.createRange();o.moveToElementEditStart(u),o.select()}}},null,null,-2),u.attachListener(u,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){l&&CKEDITOR.env.webkit&&(l=n._.previousActive&&n._.previousActive.equals(E.getActive()))&&null!=n._.previousScrollTop&&n._.previousScrollTop!=u.$.scrollTop&&(u.$.scrollTop=n._.previousScrollTop),n.unlockSelection(l),l=0},null,null,-1),u.attachListener(u,"mousedown",function(){l=0}),(CKEDITOR.env.ie||T)&&(S?u.attachListener(u,"beforedeactivate",e,null,null,-1):u.attachListener(n,"selectionCheck",e,null,null,-1),u.attachListener(u,CKEDITOR.env.webkit?"DOMFocusOut":"blur",function(){n.lockSelection(c),l=1},null,null,-1),u.attachListener(u,"mousedown",function(){l=0})),CKEDITOR.env.ie&&!T){var C;if(u.attachListener(u,"mousedown",function(e){if(2==e.data.$.button){var t=n.document.getSelection();t&&t.getType()!=CKEDITOR.SELECTION_NONE||(C=n.window.getScrollPosition())}}),u.attachListener(u,"mouseup",function(e){2==e.data.$.button&&C&&(n.document.$.documentElement.scrollLeft=C.x,n.document.$.documentElement.scrollTop=C.y),C=null}),"BackCompat"!=E.$.compatMode){if(CKEDITOR.env.ie7Compat||CKEDITOR.env.ie6Compat){var O,m;h.on("mousedown",function(e){function n(e){if(e=e.data.$,O){var n=g.$.createTextRange();t(n,e.clientX,e.clientY),O.setEndPoint(m.compareEndPoints("StartToStart",n)<0?"EndToEnd":"StartToStart",n),O.select()}}function o(){d.removeListener("mouseup",i),h.removeListener("mouseup",i)}function i(){h.removeListener("mousemove",n),o(),O.select()}(e=e.data).getTarget().is("html")&&e.$.y<h.$.clientHeight&&e.$.x<h.$.clientWidth&&(t(O=g.$.createTextRange(),e.$.clientX,e.$.clientY),m=O.duplicate(),h.on("mousemove",n),d.on("mouseup",i),h.on("mouseup",i))})}CKEDITOR.env.version>7&&CKEDITOR.env.version<11&&h.on("mousedown",function(e){e.data.getTarget().is("html")&&(d.on("mouseup",i),h.on("mouseup",i))})}}if(u.attachListener(u,"selectionchange",a,n),u.attachListener(u,"keyup",s,n),u.attachListener(u,"keydown",function(e){var t=this.getSelection(1);r(t)&&(t.selectElement(r(t)),e.data.preventDefault())},n),u.attachListener(u,CKEDITOR.env.webkit?"DOMFocusIn":"focus",function(){n.forceNextSelectionCheck(),n.selectionChange(1)}),T&&(CKEDITOR.env.webkit||CKEDITOR.env.gecko)){var R;u.attachListener(u,"mousedown",function(){R=1}),u.attachListener(E.getDocumentElement(),"mouseup",function(){R&&s.call(n),R=0})}else u.attachListener(CKEDITOR.env.ie?u:E.getDocumentElement(),"mouseup",s,n);CKEDITOR.env.webkit&&u.attachListener(E,"keydown",function(e){switch(e.data.getKey()){case 13:case 33:case 34:case 35:case 36:case 37:case 39:case 8:case 45:case 46:u.hasFocus&&f(u)}},null,null,-1),u.attachListener(u,"keydown",v(n),null,null,-1)}),n.on("setData",function(){n.unlockSelection(),CKEDITOR.env.webkit&&t()}),n.on("contentDomUnload",function(){n.unlockSelection()}),CKEDITOR.env.ie9Compat&&n.on("beforeDestroy",t,null,null,9),n.on("dataReady",function(){delete n._.fakeSelection,delete n._.hiddenSelectionContainer,n.selectionChange(1)}),n.on("loadSnapshot",function(){var e=CKEDITOR.dom.walker.nodeType(CKEDITOR.NODE_ELEMENT),t=n.editable().getLast(e);if(t&&t.hasAttribute("data-cke-hidden-sel")&&(t.remove(),CKEDITOR.env.gecko)){var o=n.editable().getFirst(e);o&&o.is("br")&&o.getAttribute("_moz_editor_bogus_node")&&o.remove()}},null,null,100),n.on("key",function(e){if("wysiwyg"==n.mode){var t=n.getSelection();if(t.isFake){var o=L[e.data.keyCode];return o?o({editor:n,selected:t.getSelectedElement(),selection:t,keyEvent:e}):void 0}}})}),CKEDITOR.env.webkit&&CKEDITOR.on("instanceReady",function(e){var t=e.editor;t.on("selectionChange",function(){u(t.editable())},null,null,-1),t.on("beforeSetMode",function(){f(t.editable())},null,null,-1),t.on("getSnapshot",function(e){e.data&&(e.data=g(e.data))},t,null,20),t.on("toDataFormat",function(e){e.data.dataValue=g(e.data.dataValue)},null,null,0)}),CKEDITOR.editor.prototype.selectionChange=function(e){(e?a:s).call(this)},CKEDITOR.editor.prototype.getSelection=function(e){if((this._.savedSelection||this._.fakeSelection)&&!e)return this._.savedSelection||this._.fakeSelection;var t=this.editable();return t&&"wysiwyg"==this.mode?new CKEDITOR.dom.selection(t):null},CKEDITOR.editor.prototype.lockSelection=function(e){return(e=e||this.getSelection(1)).getType()!=CKEDITOR.SELECTION_NONE&&(!e.isLocked&&e.lock(),this._.savedSelection=e,!0)},CKEDITOR.editor.prototype.unlockSelection=function(e){var t=this._.savedSelection;return!!t&&(t.unlock(e),delete this._.savedSelection,!0)},CKEDITOR.editor.prototype.forceNextSelectionCheck=function(){delete this._.selectionPreviousPath},CKEDITOR.dom.document.prototype.getSelection=function(){return new CKEDITOR.dom.selection(this)},CKEDITOR.dom.range.prototype.select=function(){var e=this.root instanceof CKEDITOR.editable?this.root.editor.getSelection():new CKEDITOR.dom.selection(this.root);return e.selectRanges([this]),e},CKEDITOR.SELECTION_NONE=1,CKEDITOR.SELECTION_TEXT=2,CKEDITOR.SELECTION_ELEMENT=3,CKEDITOR.dom.selection=function(e){if(e instanceof CKEDITOR.dom.selection){var t=e;e=e.root}var n=e instanceof CKEDITOR.dom.element;if(this.rev=t?t.rev:K++,this.document=e instanceof CKEDITOR.dom.document?e:e.getDocument(),this.root=n?e:this.document.getBody(),this.isLocked=0,this._={cache:{}},t)return CKEDITOR.tools.extend(this._.cache,t._.cache),this.isFake=t.isFake,this.isLocked=t.isLocked,this;var o,i,r=this.getNative();if(r)if(r.getRangeAt)o=(i=r.rangeCount&&r.getRangeAt(0))&&new CKEDITOR.dom.node(i.commonAncestorContainer);else{try{i=r.createRange()}catch(e){}o=i&&CKEDITOR.dom.element.get(i.item&&i.item(0)||i.parentElement())}return(!o||o.type!=CKEDITOR.NODE_ELEMENT&&o.type!=CKEDITOR.NODE_TEXT||!this.root.equals(o)&&!this.root.contains(o))&&(this._.cache.type=CKEDITOR.SELECTION_NONE,this._.cache.startElement=null,this._.cache.selectedElement=null,this._.cache.selectedText="",this._.cache.ranges=new CKEDITOR.dom.rangeList),this};var b={img:1,hr:1,li:1,table:1,tr:1,td:1,th:1,embed:1,object:1,ol:1,ul:1,a:1,input:1,form:1,select:1,textarea:1,button:1,fieldset:1,thead:1,tfoot:1};CKEDITOR.tools.extend(CKEDITOR.dom.selection,{_removeFillingCharSequenceString:g,_createFillingCharSequenceNode:d,FILLING_CHAR_SEQUENCE:_}),CKEDITOR.dom.selection.prototype={getNative:function(){return void 0!==this._.cache.nativeSel?this._.cache.nativeSel:this._.cache.nativeSel=S?this.document.$.selection:this.document.getWindow().$.getSelection()},getType:S?function(){var e=this._.cache;if(e.type)return e.type;var t=CKEDITOR.SELECTION_NONE;try{var n=this.getNative(),o=n.type;"Text"==o&&(t=CKEDITOR.SELECTION_TEXT),"Control"==o&&(t=CKEDITOR.SELECTION_ELEMENT),n.createRange().parentElement()&&(t=CKEDITOR.SELECTION_TEXT)}catch(e){}return e.type=t}:function(){var e=this._.cache;if(e.type)return e.type;var t=CKEDITOR.SELECTION_TEXT,n=this.getNative();if(n&&n.rangeCount){if(1==n.rangeCount){var o=n.getRangeAt(0),i=o.startContainer;i==o.endContainer&&1==i.nodeType&&o.endOffset-o.startOffset==1&&b[i.childNodes[o.startOffset].nodeName.toLowerCase()]&&(t=CKEDITOR.SELECTION_ELEMENT)}}else t=CKEDITOR.SELECTION_NONE;return e.type=t},getRanges:function(){var e=S?function(){function e(e){return new CKEDITOR.dom.node(e).getIndex()}var t=function(t,n){(t=t.duplicate()).collapse(n);var o=t.parentElement();if(!o.hasChildNodes())return{container:o,offset:0};for(var i,r,a,s,l,c=o.children,E=t.duplicate(),d=0,u=c.length-1,f=-1;d<=u;)if(f=Math.floor((d+u)/2),i=c[f],E.moveToElementText(i),(a=E.compareEndPoints("StartToStart",t))>0)u=f-1;else{if(!(a<0))return{container:o,offset:e(i)};d=f+1}if(-1==f||f==c.length-1&&a<0){if(E.moveToElementText(o),E.setEndPoint("StartToStart",t),s=E.text.replace(/(\r\n|\r)/g,"\n").length,c=o.childNodes,!s)return i=c[c.length-1],i.nodeType!=CKEDITOR.NODE_TEXT?{container:o,offset:c.length}:{container:i,offset:i.nodeValue.length};for(var g=c.length;s>0&&g>0;)(r=c[--g]).nodeType==CKEDITOR.NODE_TEXT&&(l=r,s-=r.nodeValue.length);return{container:l,offset:-s}}if(E.collapse(a>0),E.setEndPoint(a>0?"StartToStart":"EndToStart",t),!(s=E.text.replace(/(\r\n|\r)/g,"\n").length))return{container:o,offset:e(i)+(a>0?0:1)};for(;s>0;)try{(r=i[a>0?"previousSibling":"nextSibling"]).nodeType==CKEDITOR.NODE_TEXT&&(s-=r.nodeValue.length,l=r),i=r}catch(t){return{container:o,offset:e(i)}}return{container:l,offset:a>0?-s:l.nodeValue.length+s}};return function(){var e,n=this.getNative(),o=n&&n.createRange(),i=this.getType();if(!n)return[];if(i==CKEDITOR.SELECTION_TEXT){e=new CKEDITOR.dom.range(this.root);var r=t(o,!0);return e.setStart(new CKEDITOR.dom.node(r.container),r.offset),r=t(o),e.setEnd(new CKEDITOR.dom.node(r.container),r.offset),e.endContainer.getPosition(e.startContainer)&CKEDITOR.POSITION_PRECEDING&&e.endOffset<=e.startContainer.getIndex()&&e.collapse(),[e]}if(i==CKEDITOR.SELECTION_ELEMENT){for(var a=[],s=0;s<o.length;s++){var l=o.item(s),c=l.parentNode,E=0;for(e=new CKEDITOR.dom.range(this.root);E<c.childNodes.length&&c.childNodes[E]!=l;E++);e.setStart(new CKEDITOR.dom.node(c),E),e.setEnd(new CKEDITOR.dom.node(c),E+1),a.push(e)}return a}return[]}}():function(){var e,t=[],n=this.getNative();if(!n)return t;for(var o=0;o<n.rangeCount;o++){var i=n.getRangeAt(o);(e=new CKEDITOR.dom.range(this.root)).setStart(new CKEDITOR.dom.node(i.startContainer),i.startOffset),e.setEnd(new CKEDITOR.dom.node(i.endContainer),i.endOffset),t.push(e)}return t};return function(t){var n=this._.cache,o=n.ranges;return o||(n.ranges=o=new CKEDITOR.dom.rangeList(e.call(this))),t?D(new CKEDITOR.dom.rangeList(o.slice())):o}}(),getStartElement:function(){var e=this._.cache;if(void 0!==e.startElement)return e.startElement;var t;switch(this.getType()){case CKEDITOR.SELECTION_ELEMENT:return this.getSelectedElement();case CKEDITOR.SELECTION_TEXT:var n=this.getRanges()[0];if(n){if(n.collapsed)(t=n.startContainer).type!=CKEDITOR.NODE_ELEMENT&&(t=t.getParent());else{for(n.optimize();;){var o=n.startContainer;if(n.startOffset!=(o.getChildCount?o.getChildCount():o.getLength())||o.isBlockBoundary())break;n.setStartAfter(o)}if((t=n.startContainer).type!=CKEDITOR.NODE_ELEMENT)return t.getParent();if((t=t.getChild(n.startOffset))&&t.type==CKEDITOR.NODE_ELEMENT)for(var i=t.getFirst();i&&i.type==CKEDITOR.NODE_ELEMENT;)t=i,i=i.getFirst();else t=n.startContainer}t=t.$}}return e.startElement=t?new CKEDITOR.dom.element(t):null},getSelectedElement:function(){var e=this._.cache;if(void 0!==e.selectedElement)return e.selectedElement;var t=this,n=CKEDITOR.tools.tryThese(function(){return t.getNative().createRange().item(0)},function(){for(var e,n,o=t.getRanges()[0].clone(),i=2;i&&!((e=o.getEnclosedNode())&&e.type==CKEDITOR.NODE_ELEMENT&&b[e.getName()]&&(n=e));i--)o.shrink(CKEDITOR.SHRINK_ELEMENT);return n&&n.$});return e.selectedElement=n?new CKEDITOR.dom.element(n):null},getSelectedText:function(){var e=this._.cache;if(void 0!==e.selectedText)return e.selectedText;var t=this.getNative(),n=S?"Control"==t.type?"":t.createRange().text:t.toString();return e.selectedText=n},lock:function(){this.getRanges(),this.getStartElement(),this.getSelectedElement(),this.getSelectedText(),this._.cache.nativeSel=null,this.isLocked=1},unlock:function(e){if(this.isLocked){if(e)var n=this.getSelectedElement(),o=this.getRanges(),i=this.isFake;if(this.isLocked=0,this.reset(),e){var a=n||o[0]&&o[0].getCommonAncestor();if(!a||!a.getAscendant("body",1))return;t(o)?r.call(this,o):i?this.fake(n):n?this.selectElement(n):this.selectRanges(o)}}},reset:function(){this._.cache={},this.isFake=0;var e=this.root.editor;e&&e._.fakeSelection&&(this.rev==e._.fakeSelection.rev?(delete e._.fakeSelection,O(e)):CKEDITOR.warn("selection-fake-reset")),this.rev=K++},selectElement:function(e){var t=new CKEDITOR.dom.range(this.root);t.setStartBefore(e),t.setEndAfter(e),this.selectRanges([t])},selectRanges:function(e){var n=this.root.editor,o=n&&n._.hiddenSelectionContainer;if(this.reset(),o&&R(e,this.root),e.length){if(this.isLocked){var i=CKEDITOR.document.getActive();return this.unlock(),this.selectRanges(e),this.lock(),void(i&&!i.equals(this.root)&&i.focus())}var a=m(e);if(a)this.fake(a);else if(n&&n.plugins.tableselection&&CKEDITOR.plugins.tableselection.isSupportedEnvironment&&t(e)&&!I)r.call(this,e);else{if(S){var s=CKEDITOR.dom.walker.whitespaces(!0),l=/\ufeff|\u00a0/,c={table:1,tbody:1,tr:1};if(e.length>1){var u=e[e.length-1];e[0].setEnd(u.endContainer,u.endOffset)}var g,h,T,C=e[0],O=C.collapsed,v=C.getEnclosedNode();if(v&&v.type==CKEDITOR.NODE_ELEMENT&&v.getName()in b&&(!v.is("a")||!v.getText()))try{return(T=v.$.createControlRange()).addElement(v.$),void T.select()}catch(e){}(C.startContainer.type==CKEDITOR.NODE_ELEMENT&&C.startContainer.getName()in c||C.endContainer.type==CKEDITOR.NODE_ELEMENT&&C.endContainer.getName()in c)&&(C.shrink(CKEDITOR.NODE_ELEMENT,!0),O=C.collapsed);var D,p=C.createBookmark(),N=p.startNode;if(O||(D=p.endNode),(T=C.document.$.body.createTextRange()).moveToElementText(N.$),T.moveStart("character",1),D){var K=C.document.$.body.createTextRange();K.moveToElementText(D.$),T.setEndPoint("EndToEnd",K),T.moveEnd("character",-1)}else{var _=N.getNext(s),k=N.hasAscendant("pre");g=!(_&&_.getText&&_.getText().match(l))&&(k||!N.hasPrevious()||N.getPrevious().is&&N.getPrevious().is("br")),(h=C.document.createElement("span")).setHtml("&#65279;"),h.insertBefore(N),g&&C.document.createText("\ufeff").insertBefore(N)}C.setStartBefore(N),N.remove(),O?(g?(T.moveStart("character",-1),T.select(),C.document.$.selection.clear()):T.select(),C.moveToPosition(h,CKEDITOR.POSITION_BEFORE_START),h.remove()):(C.setEndBefore(D),D.remove(),T.select())}else{var y=this.getNative();if(!y)return;this.removeAllRanges();for(var L=0;L<e.length;L++){if(L<e.length-1){var w=e[L],A=e[L+1],x=w.clone();if(x.setStart(w.endContainer,w.endOffset),x.setEnd(A.startContainer,A.startOffset),!x.collapsed){x.shrink(CKEDITOR.NODE_ELEMENT,!0);var P=x.getCommonAncestor(),$=x.getEnclosedNode();if(P.isReadOnly()||$&&$.isReadOnly()){A.setStart(w.startContainer,w.startOffset),e.splice(L--,1);continue}}}C=e[L];var M=this.document.$.createRange();if(C.collapsed&&CKEDITOR.env.webkit&&E(C)){var F=d(this.root);C.insertNode(F),(_=F.getNext())&&!F.getPrevious()&&_.type==CKEDITOR.NODE_ELEMENT&&"br"==_.getName()?(f(this.root),C.moveToPosition(_,CKEDITOR.POSITION_BEFORE_START)):C.moveToPosition(F,CKEDITOR.POSITION_AFTER_END)}M.setStart(C.startContainer.$,C.startOffset);try{M.setEnd(C.endContainer.$,C.endOffset)}catch(e){if(!(e.toString().indexOf("NS_ERROR_ILLEGAL_VALUE")>=0))throw e;C.collapse(1),M.setEnd(C.endContainer.$,C.endOffset)}y.addRange(M)}}this.reset(),this.root.fire("selectionchange")}}},fake:function(e,t){var n=this.root.editor;void 0===t&&e.hasAttribute("aria-label")&&(t=e.getAttribute("aria-label")),this.reset(),C(n,t);var o=this._.cache,i=new CKEDITOR.dom.range(this.root);i.setStartBefore(e),i.setEndAfter(e),o.ranges=new CKEDITOR.dom.rangeList(i),o.selectedElement=o.startElement=e,o.type=CKEDITOR.SELECTION_ELEMENT,o.selectedText=o.nativeSel=null,this.isFake=1,this.rev=K++,n._.fakeSelection=this,this.root.fire("selectionchange")},isHidden:function(){var e=this.getCommonAncestor();return e&&e.type==CKEDITOR.NODE_TEXT&&(e=e.getParent()),!(!e||!e.data("cke-hidden-sel"))},isInTable:function(e){return t(this.getRanges(),e)},isCollapsed:function(){var e=this.getRanges();return 1===e.length&&e[0].collapsed},createBookmarks:function(e){var t=this.getRanges().createBookmarks(e);return this.isFake&&(t.isFake=1),t},createBookmarks2:function(e){var t=this.getRanges().createBookmarks2(e);return this.isFake&&(t.isFake=1),t},selectBookmarks:function(e){for(var n,o=[],i=0;i<e.length;i++){var r=new CKEDITOR.dom.range(this.root);r.moveToBookmark(e[i]),o.push(r)}return e.isFake&&((n=t(o)?o[0]._getTableElement():o[0].getEnclosedNode())&&n.type==CKEDITOR.NODE_ELEMENT||(CKEDITOR.warn("selection-not-fake"),e.isFake=0)),e.isFake&&!t(o)?this.fake(n):this.selectRanges(o),this},getCommonAncestor:function(){var e=this.getRanges();if(!e.length)return null;var t=e[0].startContainer,n=e[e.length-1].endContainer;return t.getCommonAncestor(n)},scrollIntoView:function(){this.type!=CKEDITOR.SELECTION_NONE&&this.getRanges()[0].scrollIntoView()},removeAllRanges:function(){if(this.getType()!=CKEDITOR.SELECTION_NONE){var e=this.getNative();try{e&&e[S?"empty":"removeAllRanges"]()}catch(e){}this.reset()}}}}();